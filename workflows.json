{"data":[{"updatedAt":"2026-02-04T15:42:34.769Z","createdAt":"2026-01-30T15:41:08.589Z","id":"2rN72rtR8JAX9rV5","name":"Shopify Occasions - Batch Update (Pagination 250)","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"manual-trigger","name":"1?? DÔøΩmarrage","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[240,1504]},{"parameters":{"jsCode":"// Initialiser la pagination\nreturn [{\n  json: {\n    sinceId: 0,\n    batchNumber: 0,\n    totalProcessed: 0,\n    totalSuccess: 0,\n    totalSkipped: 0\n  }\n}];"},"id":"init-pagination","name":"2?? Initialize Pagination","type":"n8n-nodes-base.code","typeVersion":2,"position":[464,1504]},{"parameters":{"authentication":"oAuth2","resource":"product","operation":"getAll","limit":10,"additionalFields":{}},"id":"shopify-get-products","name":"3?? Shopify - Get 250 Products","type":"n8n-nodes-base.shopify","typeVersion":1,"position":[688,1504],"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"has-products","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"any","operation":"exists"}}],"combinator":"and"},"options":{}},"id":"check-has-products","name":"4?? Has Products?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[912,1432]},{"parameters":{"options":{"reset":false}},"id":"loop-products-in-batch","name":"5?? Loop Over Products","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1136,1312]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const product = $input.item.json;\n\n// Fonction: compter caractÔøΩres HTML\nfunction getCharacterCount(html) {\n    if (!html) return 0;\n    const cleaned = html.replace(/<[^>]*>/g, '').trim();\n    return cleaned.length;\n}\n\nfunction cleanHTML(html) {\n    if (!html) return '';\n    return html.replace(/<[^>]*>/g, '').trim();\n}\n\n// Extraction description\nconst bodyHtml = product.body_html || '';\nconst descriptionCharCount = getCharacterCount(bodyHtml);\nconst descriptionCleaned = cleanHTML(bodyHtml);\n\n// Extraction variants et vÔøΩrification stock\nconst variants = product.variants || [];\nconst hasStockVariant = variants.some(v => (v.inventory_quantity || 0) > 0);\nconst totalInventory = variants.reduce((sum, v) => sum + (v.inventory_quantity || 0), 0);\n\n// Construction objet final\nreturn {\n    json: {\n        id: product.id,\n        title: product.title || '',\n        vendor: product.vendor || '',\n        productType: product.product_type || '',\n        status: product.status || '',\n        bodyHtml: bodyHtml,\n        description: descriptionCleaned.substring(0, 1000),\n        descriptionCharCount: descriptionCharCount,\n        hasStock: hasStockVariant,\n        totalInventory: totalInventory,\n        tags: product.tags || ''\n    }\n};"},"id":"extract-data","name":"6?? Extract Product Data","type":"n8n-nodes-base.code","typeVersion":2,"position":[1360,952]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"title-check","leftValue":"={{ $json.title }}","rightValue":"","operator":{"type":"string","operation":"notEmpty"}},{"id":"type-check","leftValue":"={{ $json.productType }}","rightValue":"","operator":{"type":"string","operation":"notEmpty"}},{"id":"status-check","leftValue":"={{ $json.status }}","rightValue":"active","operator":{"type":"string","operation":"equals"}},{"id":"stock-check","leftValue":"={{ $json.hasStock }}","rightValue":true,"operator":{"type":"boolean","operation":"true"}},{"id":"description-check","leftValue":"={{ $json.descriptionCharCount }}","rightValue":100,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"id":"filter-products","name":"7?? Filtre Strict","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1584,952]},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const data = $input.item.json;\n\n// Liste des occasions disponibles\nconst occasionsList = [\n    \"Mariage\",\n    \"SoirÔøΩe\",\n    \"Cadeau Femme\",\n    \"Cadeau Homme\",\n    \"Cadeau ado\",\n    \"Saint-Valentin\",\n    \"NoÔøΩl\",\n    \"Travail\",\n    \"ÔøΩtudes\",\n    \"Voyages\",\n    \"Business Trip\",\n    \"Quotidien\",\n    \"Sortie entre amis\"\n];\n\nconst systemPrompt = `Tu es un expert en classification de produits e-commerce pour un site mode/accessoires/lifestyle.\n\nMISSION : Analyser les caractÔøΩristiques d'un produit et sÔøΩlectionner EXACTEMENT 2 occasions les plus pertinentes.\n\nRÔøΩGLES STRICTES IMPÔøΩRATIVES :\n1. Tu DOIS choisir EXACTEMENT 2 occasions parmi cette liste FERMÔøΩE :\n   - Mariage\n   - SoirÔøΩe\n   - Cadeau Femme\n   - Cadeau Homme\n   - Cadeau ado\n   - Saint-Valentin\n   - NoÔøΩl\n   - Travail\n   - ÔøΩtudes\n   - Voyages\n   - Business Trip\n   - Quotidien\n   - Sortie entre amis\n\n2. FORMAT DE SORTIE OBLIGATOIRE : JSON array avec EXACTEMENT 2 valeurs, AUCUN texte avant/aprÔøΩs\n   Exemple valide : [\\\"NoÔøΩl\\\", \\\"Cadeau Femme\\\"]\n\n3. INTERDICTIONS ABSOLUES :\n   - Aucune valeur hors de la liste ci-dessus\n   - Exactement 2 valeurs (ni plus, ni moins)\n   - Pas d'explication textuelle\n   - Respecter strictement l'orthographe et majuscules de la liste\n\n4. CRITÔøΩRES DE SÔøΩLECTION :\n   - Analyser le titre, type de produit, et description\n   - Choisir les 2 occasions les plus pertinentes et ÔøΩvidentes\n   - Si le produit convient pour une seule occasion ÔøΩvidente, ajouter \\\"Quotidien\\\" comme deuxiÔøΩme option\n\nTu rÔøΩponds UNIQUEMENT avec le JSON array de 2 ÔøΩlÔøΩments. Rien d'autre.`;\n\nconst userPrompt = `Analyse ce produit et sÔøΩlectionne EXACTEMENT 2 occasions pertinentes parmi cette liste:\n\nLISTE DES OCCASIONS DISPONIBLES:\n${occasionsList.map(o => `- ${o}`).join('\\n')}\n\nPRODUIT ÔøΩ ANALYSER:\n- Titre: ${data.title}\n- Type de produit: ${data.productType}\n- Description: ${data.description}\n\nRÔøΩponds UNIQUEMENT avec un JSON array de EXACTEMENT 2 occasions.\nExemple: [\"NoÔøΩl\", \"Cadeau Femme\"]`;\n\nreturn {\n    json: {\n        productId: data.id,\n        productTitle: data.title,\n        productType: data.productType,\n        description: data.description,\n        systemPrompt: systemPrompt,\n        userPrompt: userPrompt\n    }\n};"},"id":"build-prompt","name":"8?? Build AI Prompt","type":"n8n-nodes-base.code","typeVersion":2,"position":[1808,880]},{"parameters":{"method":"POST","url":"https://models.inference.ai.azure.com/chat/completions","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer YOUR_GITHUB_TOKEN_HERE"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": {{ JSON.stringify($json.systemPrompt) }}\n    },\n    {\n      \"role\": \"user\",\n      \"content\": {{ JSON.stringify($json.userPrompt) }}\n    }\n  ],\n  \"model\": \"gpt-4o\",\n  \"temperature\": 0.3,\n  \"max_tokens\": 150\n}","options":{"timeout":30000}},"id":"github-models-api","name":"9?? GitHub Copilot GPT-4","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2032,880],"retryOnFail":true,"maxTries":2,"waitBetweenTries":1000,"continueOnFail":true},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const currentItem = $input.item.json;\nconst previousNode = $('8?? Build AI Prompt').item.json;\n\nconst VALID_OCCASIONS = [\n    \"Mariage\",\n    \"SoirÔøΩe\",\n    \"Cadeau Femme\",\n    \"Cadeau Homme\",\n    \"Cadeau ado\",\n    \"Saint-Valentin\",\n    \"NoÔøΩl\",\n    \"Travail\",\n    \"ÔøΩtudes\",\n    \"Voyages\",\n    \"Business Trip\",\n    \"Quotidien\",\n    \"Sortie entre amis\"\n];\n\nlet occasions = [];\nlet parseError = null;\n\ntry {\n    // Extraire le contenu de la rÔøΩponse\n    const content = currentItem.choices?.[0]?.message?.content || '';\n    \n    // Parser JSON\n    const parsed = JSON.parse(content.trim());\n    \n    // Validation\n    if (!Array.isArray(parsed)) {\n        throw new Error('La rÔøΩponse n\\'est pas un array');\n    }\n    \n    // Filtrer pour ne garder que les occasions valides\n    occasions = parsed.filter(occ => VALID_OCCASIONS.includes(occ));\n    \n    // On veut EXACTEMENT 2 occasions\n    if (occasions.length >= 2) {\n        occasions = occasions.slice(0, 2);\n    } else if (occasions.length === 1) {\n        // Si seulement 1 occasion, ajouter \"Quotidien\" comme fallback\n        occasions.push('Quotidien');\n        parseError = '1 seule occasion dÔøΩtectÔøΩe, ajout de Quotidien';\n    } else {\n        // Si aucune occasion valide, utiliser fallback\n        occasions = ['Quotidien', 'Sortie entre amis'];\n        parseError = 'Aucune occasion valide dÔøΩtectÔøΩe, fallback';\n    }\n    \n} catch (error) {\n    // En cas d'erreur de parsing, fallback\n    occasions = ['Quotidien', 'Sortie entre amis'];\n    parseError = `Erreur parsing: ${error.message}`;\n}\n\nreturn {\n    json: {\n        productId: previousNode.productId,\n        productTitle: previousNode.productTitle,\n        occasions: occasions,\n        occasionsString: occasions.join(', '),\n        parseError: parseError\n    }\n};"},"id":"parse-ai-response","name":"?? Parse AI Response","type":"n8n-nodes-base.code","typeVersion":2,"position":[2256,880]},{"parameters":{"method":"POST","url":"=https://luckybag-paris.myshopify.com/admin/api/2024-01/products/{{ $json.productId }}/metafields.json","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"metafield\": {\n    \"namespace\": \"custom\",\n    \"key\": \"occasions\",\n    \"value\": {{ JSON.stringify($json.occasionsString) }},\n    \"type\": \"single_line_text_field\"\n  }\n}","options":{}},"id":"shopify-update-metafield","name":"1??1?? Shopify - Update Occasions","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[2480,880],"retryOnFail":true,"maxTries":3,"waitBetweenTries":2000,"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}},"continueOnFail":true},{"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","value":"SUCCESS","type":"string"},{"id":"product-id","name":"productId","value":"={{ $json.productId }}","type":"string"},{"id":"product-title","name":"productTitle","value":"={{ $json.productTitle }}","type":"string"},{"id":"occasions","name":"occasions","value":"={{ $json.occasionsString }}","type":"string"}]},"options":{}},"id":"log-success","name":"1??2?? Log Success","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2704,880]},{"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","value":"SKIPPED","type":"string"},{"id":"product-id","name":"productId","value":"={{ $json.id }}","type":"string"},{"id":"reason","name":"skipReason","value":"=Filtre: Titre={{ $json.title ? 'OK' : '?' }} | Type={{ $json.productType ? 'OK' : '?' }} | Statut={{ $json.status === 'active' ? 'OK' : '? ' + $json.status }} | Stock={{ $json.hasStock ? 'OK' : '? 0' }} | Desc={{ $json.descriptionCharCount > 100 ? 'OK' : '? ' + $json.descriptionCharCount }}","type":"string"}]},"options":{}},"id":"log-skip","name":"1??3?? Log Skip","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2704,1072]},{"parameters":{},"id":"merge-results","name":"1??4?? Merge","type":"n8n-nodes-base.merge","typeVersion":3,"position":[2928,952]},{"parameters":{"jsCode":"// RÔøΩcupÔøΩrer tous les items traitÔøΩs du batch\nconst allItems = $input.all();\n\n// RÔøΩcupÔøΩrer les donnÔøΩes de pagination du node Initialize\nconst paginationData = $('2?? Initialize Pagination').item.json;\n\n// RÔøΩcupÔøΩrer les produits du batch depuis le node Get Products\nconst batchProducts = $('3?? Shopify - Get 250 Products').all();\n\n// Trouver le dernier ID de produit (le plus grand)\nlet lastProductId = paginationData.sinceId || 0;\nif (batchProducts.length > 0) {\n    const productIds = batchProducts.map(p => parseInt(p.json.id)).filter(id => !isNaN(id));\n    if (productIds.length > 0) {\n        lastProductId = Math.max(...productIds);\n    }\n}\n\n// Compter succÔøΩs et skips\nconst successCount = allItems.filter(item => item.json.status === 'SUCCESS').length;\nconst skipCount = allItems.filter(item => item.json.status === 'SKIPPED').length;\n\n// Mettre ÔøΩ jour les compteurs totaux\nconst batchNumber = (paginationData.batchNumber || 0) + 1;\nconst totalProcessed = (paginationData.totalProcessed || 0) + allItems.length;\nconst totalSuccess = (paginationData.totalSuccess || 0) + successCount;\nconst totalSkipped = (paginationData.totalSkipped || 0) + skipCount;\n\n// DÔøΩterminer si on doit continuer (si on a rÔøΩcupÔøΩrÔøΩ 250 produits, il y en a probablement plus)\nconst shouldContinue = batchProducts.length >= 250;\n\nreturn [{\n    json: {\n        sinceId: lastProductId,\n        batchNumber: batchNumber,\n        batchSize: allItems.length,\n        batchSuccess: successCount,\n        batchSkipped: skipCount,\n        totalProcessed: totalProcessed,\n        totalSuccess: totalSuccess,\n        totalSkipped: totalSkipped,\n        shouldContinue: shouldContinue,\n        status: 'BATCH_COMPLETE'\n    }\n}];"},"id":"update-pagination","name":"1??5?? Update Pagination State","type":"n8n-nodes-base.code","typeVersion":2,"position":[1360,1288]},{"parameters":{"conditions":{"options":{"version":2},"conditions":[{"id":"should-continue","leftValue":"={{ $json.shouldContinue }}","rightValue":true,"operator":{"type":"boolean","operation":"true"}}],"combinator":"and"},"options":{}},"id":"check-continue-loop","name":"1??6?? Continue Loop?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1584,1288]},{"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","value":"WORKFLOW_COMPLETE","type":"string"},{"id":"total-batches","name":"totalBatches","value":"={{ $json.batchNumber }}","type":"number"},{"id":"total-processed","name":"totalProcessed","value":"={{ $json.totalProcessed }}","type":"number"},{"id":"total-success","name":"totalSuccess","value":"={{ $json.totalSuccess }}","type":"number"},{"id":"total-skipped","name":"totalSkipped","value":"={{ $json.totalSkipped }}","type":"number"}]},"options":{}},"id":"final-summary","name":"1??7?? Final Summary","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1808,1408]},{"parameters":{"amount":0.05},"id":"wait-product-rate-limit","name":"?? Wait (0.05s per product)","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[3152,1192],"webhookId":"product-rate-limit-wait"},{"parameters":{"amount":1},"id":"wait-batch-rate-limit","name":"?? Wait (1s between batches)","type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1808,1216],"webhookId":"batch-rate-limit-wait"}],"connections":{"1?? DÔøΩmarrage":{"main":[[{"node":"2?? Initialize Pagination","type":"main","index":0}]]},"2?? Initialize Pagination":{"main":[[{"node":"3?? Shopify - Get 250 Products","type":"main","index":0}]]},"3?? Shopify - Get 250 Products":{"main":[[{"node":"4?? Has Products?","type":"main","index":0}]]},"4?? Has Products?":{"main":[[{"node":"5?? Loop Over Products","type":"main","index":0}],[{"node":"1??7?? Final Summary","type":"main","index":0}]]},"5?? Loop Over Products":{"main":[[{"node":"1??5?? Update Pagination State","type":"main","index":0}],[{"node":"6?? Extract Product Data","type":"main","index":0}]]},"6?? Extract Product Data":{"main":[[{"node":"7?? Filtre Strict","type":"main","index":0}]]},"7?? Filtre Strict":{"main":[[{"node":"8?? Build AI Prompt","type":"main","index":0}],[{"node":"1??3?? Log Skip","type":"main","index":0}]]},"8?? Build AI Prompt":{"main":[[{"node":"9?? GitHub Copilot GPT-4","type":"main","index":0}]]},"9?? GitHub Copilot GPT-4":{"main":[[{"node":"?? Parse AI Response","type":"main","index":0}]]},"?? Parse AI Response":{"main":[[{"node":"1??1?? Shopify - Update Occasions","type":"main","index":0}]]},"1??1?? Shopify - Update Occasions":{"main":[[{"node":"1??2?? Log Success","type":"main","index":0}]]},"1??2?? Log Success":{"main":[[{"node":"1??4?? Merge","type":"main","index":0}]]},"1??3?? Log Skip":{"main":[[{"node":"1??4?? Merge","type":"main","index":1}]]},"1??4?? Merge":{"main":[[{"node":"?? Wait (0.05s per product)","type":"main","index":0}]]},"1??5?? Update Pagination State":{"main":[[{"node":"1??6?? Continue Loop?","type":"main","index":0}]]},"1??6?? Continue Loop?":{"main":[[{"node":"?? Wait (1s between batches)","type":"main","index":0}],[{"node":"1??7?? Final Summary","type":"main","index":0}]]},"?? Wait (0.05s per product)":{"main":[[{"node":"5?? Loop Over Products","type":"main","index":0}]]},"?? Wait (1s between batches)":{"main":[[{"node":"3?? Shopify - Get 250 Products","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":{},"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"1dcc600b-7691-40c8-b936-4e69d202a849","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-30T15:41:08.591Z","createdAt":"2026-01-30T15:41:08.591Z","role":"workflow:owner","workflowId":"2rN72rtR8JAX9rV5","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-28T15:04:28.365Z","createdAt":"2026-01-28T15:04:28.365Z","id":"ADPD8cSo8gSqpDEa","name":"TEST - Agent IA + OpenRouter + Gmail","active":false,"isArchived":false,"nodes":[{"parameters":{"rule":{"interval":[{"field":"cronExpression","expression":"0 9 * * *"}]}},"id":"1a2b3c4d-1111-1111-1111-111111111111","name":"D√©clencheur Quotidien","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[250,300]},{"parameters":{"assignments":{"assignments":[{"id":"assign1","name":"message","value":"Test du workflow MCP - Agent IA connect√©","type":"string"},{"id":"assign2","name":"timestamp","value":"={{ $now }}","type":"string"}]},"options":{}},"id":"2b3c4d5e-2222-2222-2222-222222222222","name":"Pr√©parer Donn√©es","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[450,300]},{"parameters":{"assignments":{"assignments":[{"id":"result1","name":"agent_response","value":"‚úÖ Agent IA configur√© et pr√™t","type":"string"},{"id":"result2","name":"openrouter_status","value":"‚ö™ Non configur√©","type":"string"},{"id":"result3","name":"gmail_status","value":"‚ö™ Non configur√©","type":"string"}]},"options":{}},"id":"3c4d5e6f-3333-3333-3333-333333333333","name":"Agent IA Simulation","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[650,300]},{"parameters":{"operation":"sendEmail","fromEmail":"test@example.com","toEmail":"test@example.com","subject":"[TEST MCP] Workflow Agent IA + OpenRouter + Gmail","emailType":"text","message":"=Workflow de test ex√©cut√© avec succ√®s!\n\nTimestamp: {{ $json.timestamp }}\nMessage: {{ $json.message }}\n\nStatut des services:\n- Agent IA: {{ $json.agent_response }}\n- OpenRouter: {{ $json.openrouter_status }}\n- Gmail: {{ $json.gmail_status }}\n\nCe workflow a √©t√© cr√©√© automatiquement par le serveur MCP n8n.","options":{}},"id":"4d5e6f7g-4444-4444-4444-444444444444","name":"Notification Gmail","type":"n8n-nodes-base.gmail","typeVersion":2.1,"position":[850,300],"disabled":true}],"connections":{"D√©clencheur Quotidien":{"main":[[{"node":"Pr√©parer Donn√©es","type":"main","index":0}]]},"Pr√©parer Donn√©es":{"main":[[{"node":"Agent IA Simulation","type":"main","index":0}]]},"Agent IA Simulation":{"main":[[{"node":"Notification Gmail","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":null,"versionId":"ff3e2a1e-e375-4a45-93ac-4d51850fdf27","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-28T15:04:28.366Z","createdAt":"2026-01-28T15:04:28.366Z","role":"workflow:owner","workflowId":"ADPD8cSo8gSqpDEa","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-30T09:52:46.000Z","createdAt":"2026-01-28T15:04:15.437Z","id":"GJYYLlNUU4yxNQUH","name":"TEST-MCP-1769612654387","active":false,"isArchived":true,"nodes":[{"parameters":{},"id":"start","name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300]}],"connections":{},"settings":{"callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":null,"versionId":"a42afb90-1951-4dab-9569-9b937dfe1a70","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-28T15:04:15.438Z","createdAt":"2026-01-28T15:04:15.438Z","role":"workflow:owner","workflowId":"GJYYLlNUU4yxNQUH","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-30T09:52:45.000Z","createdAt":"2026-01-28T15:03:58.812Z","id":"JcsgZH0kFLCwjpgF","name":"TEST-MCP-1769612637772","active":false,"isArchived":true,"nodes":[{"parameters":{},"id":"start","name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300]}],"connections":{},"settings":{"callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":null,"versionId":"c6654b4b-491e-4c52-bec0-dec954b9945c","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-28T15:03:58.815Z","createdAt":"2026-01-28T15:03:58.815Z","role":"workflow:owner","workflowId":"JcsgZH0kFLCwjpgF","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-30T15:53:57.000Z","createdAt":"2026-01-30T11:08:49.264Z","id":"JoBLUPy2jmTwVLao","name":"Shopify ‚Äì Occasions (Batch Update)","active":false,"isArchived":true,"nodes":[{"id":"manual-trigger","name":"1Ô∏è‚É£ D√©marrage Manuel","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[240,400]},{"id":"create-loop","name":"2Ô∏è‚É£ Cr√©er 2 It√©rations","type":"n8n-nodes-base.code","typeVersion":2,"position":[440,400],"parameters":{"mode":"runOnceForAllItems","jsCode":"// G√©n√©rer N it√©rations (modifiable)\nconst loopCount = 2;\nconst iterations = [];\nfor (let i = 1; i <= loopCount; i++) {\n  iterations.push({ json: { iteration: i, loopCount: loopCount } });\n}\nreturn iterations;"}},{"id":"loop-batches","name":"3Ô∏è‚É£ Boucle Principale","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[640,400],"parameters":{"batchSize":1,"options":{}}},{"id":"shopify-get-product","name":"4Ô∏è‚É£ Shopify - R√©cup√©rer 1 Produit","type":"n8n-nodes-base.shopify","typeVersion":1,"position":[840,400],"parameters":{"resource":"product","operation":"getAll","returnAll":false,"limit":1,"options":{}},"credentials":{"shopifyApi":{"id":"SHOPIFY_CREDENTIAL_ID","name":"Mon Shopify"}}},{"id":"extract-data","name":"5Ô∏è‚É£ Extraire Donn√©es Produit","type":"n8n-nodes-base.code","typeVersion":2,"position":[1040,400],"parameters":{"mode":"runOnceForEachItem","jsCode":"// Extraction stricte des donn√©es requises\nconst product = $input.item.json;\n\n// Nettoyer HTML de la description\nfunction stripHtml(html) {\n  if (!html) return '';\n  return html.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, ' ').trim();\n}\n\n// Compter les mots\nfunction countWords(text) {\n  if (!text) return 0;\n  const words = text.trim().split(/\\s+/).filter(w => w.length > 0);\n  return words.length;\n}\n\n// Extraire dimensions de la premi√®re variante\nlet dimensions = 'Non disponible';\nif (product.variants && product.variants.length > 0) {\n  const v = product.variants[0];\n  const parts = [];\n  if (v.grams) parts.push(`Poids: ${v.grams}g`);\n  // Shopify n'a pas de champs L/W/H natifs, utiliser metafields si disponibles\n  dimensions = parts.length > 0 ? parts.join(', ') : 'Non disponible';\n}\n\nconst cleanDesc = stripHtml(product.body_html);\nconst wordCount = countWords(cleanDesc);\n\nreturn {\n  json: {\n    productId: product.id,\n    title: product.title || '',\n    description: cleanDesc,\n    descriptionLength: cleanDesc.length,\n    wordCount: wordCount,\n    productType: product.product_type || '',\n    vendor: product.vendor || '',\n    dimensions: dimensions,\n    originalProduct: product\n  }\n};"}},{"id":"filter-strict","name":"6Ô∏è‚É£ Filtre Strict (100+ mots)","type":"n8n-nodes-base.if","typeVersion":2,"position":[1240,400],"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict"},"conditions":[{"id":"cond1","leftValue":"={{ $json.title }}","rightValue":"","operator":{"type":"string","operation":"notEmpty"}},{"id":"cond2","leftValue":"={{ $json.productType }}","rightValue":"","operator":{"type":"string","operation":"notEmpty"}},{"id":"cond3","leftValue":"={{ $json.vendor }}","rightValue":"","operator":{"type":"string","operation":"notEmpty"}},{"id":"cond4","leftValue":"={{ $json.wordCount }}","rightValue":100,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"}}},{"id":"build-ai-prompt","name":"7Ô∏è‚É£ Construire Prompt IA","type":"n8n-nodes-base.code","typeVersion":2,"position":[1440,300],"parameters":{"mode":"runOnceForEachItem","jsCode":"// Construction du prompt pour l'IA\nconst data = $input.item.json;\n\nconst USER_PROMPT = `Analyse ce produit et s√©lectionne 1 ou 2 occasions parmi la liste fournie.\n\nPRODUIT :\nTitre: ${data.title}\nType: ${data.productType}\nVendeur: ${data.vendor}\nDescription: ${data.description.substring(0, 500)}...\nDimensions: ${data.dimensions}\n\nR√©ponds UNIQUEMENT avec le JSON array d'occasions.`;\n\nreturn {\n  json: {\n    ...data,\n    userPrompt: USER_PROMPT,\n    systemPrompt: `Tu es un expert en classification de produits mode/accessoires/lifestyle.\n\nR√àGLES STRICTES IMP√âRATIVES :\n1. Tu DOIS choisir EXACTEMENT 1 ou 2 occasions parmi cette liste FERM√âE :\n   - Mariage\n   - Soir√©e\n   - Cadeau Femme\n   - Cadeau Homme\n   - Cadeau ado\n   - Saint-Valentin\n   - No√´l\n   - Travail\n   - √âtudes\n   - Voyages\n   - Business Trip\n   - Quotidien\n   - Sortie entre amis\n\n2. FORMAT DE SORTIE OBLIGATOIRE : JSON array uniquement, AUCUN texte avant/apr√®s\n   Exemples valides :\n   [\"No√´l\", \"Cadeau Femme\"]\n   [\"Business Trip\"]\n   [\"Quotidien\", \"Travail\"]\n\n3. INTERDICTIONS ABSOLUES :\n   - Aucune valeur hors de la liste ci-dessus\n   - Maximum 2 valeurs\n   - Pas d'explication textuelle\n   - Respecter strictement l'orthographe et majuscules de la liste\n\nTu r√©ponds UNIQUEMENT avec le JSON array. Rien d'autre.`\n  }\n};"}},{"id":"ai-classify","name":"8Ô∏è‚É£ IA - Classifier (GPT-4)","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1640,300],"parameters":{"method":"POST","url":"https://models.inference.ai.azure.com/chat/completions","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ {\n  \"model\": \"gpt-4o\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": $json.systemPrompt\n    },\n    {\n      \"role\": \"user\",\n      \"content\": $json.userPrompt\n    }\n  ],\n  \"temperature\": 0.1,\n  \"max_tokens\": 50\n} }}","options":{"timeout":30000}},"credentials":{"httpHeaderAuth":{"id":"GITHUB_COPILOT_CREDENTIAL_ID","name":"GitHub Copilot"}},"continueOnFail":true},{"id":"parse-ai-response","name":"9Ô∏è‚É£ Parser R√©ponse IA","type":"n8n-nodes-base.code","typeVersion":2,"position":[1840,300],"parameters":{"mode":"runOnceForEachItem","jsCode":"// Parser et valider la r√©ponse IA\nconst VALID_OCCASIONS = [\n  \"Mariage\", \"Soir√©e\", \"Cadeau Femme\", \"Cadeau Homme\", \"Cadeau ado\",\n  \"Saint-Valentin\", \"No√´l\", \"Travail\", \"√âtudes\", \"Voyages\",\n  \"Business Trip\", \"Quotidien\", \"Sortie entre amis\"\n];\n\nlet occasions = [\"Quotidien\"]; // Fallback par d√©faut\nlet parseError = null;\n\ntry {\n  const response = $input.item.json;\n  let content = '';\n  \n  // Extraire le contenu de la r√©ponse\n  if (response.choices && response.choices[0] && response.choices[0].message) {\n    content = response.choices[0].message.content.trim();\n  } else if (response.content) {\n    content = response.content.trim();\n  }\n  \n  // Parser le JSON\n  const parsed = JSON.parse(content);\n  \n  if (Array.isArray(parsed)) {\n    // Filtrer pour garder uniquement les occasions valides\n    const filtered = parsed\n      .filter(o => VALID_OCCASIONS.includes(o))\n      .slice(0, 2); // Max 2\n    \n    if (filtered.length > 0) {\n      occasions = filtered;\n      parseError = null;\n    } else {\n      parseError = 'Aucune occasion valide trouv√©e';\n    }\n  } else {\n    parseError = 'Format non-array';\n  }\n} catch (e) {\n  parseError = `Erreur parsing: ${e.message}`;\n}\n\n// R√©cup√©rer donn√©es originales du produit\nconst originalData = $input.item.json;\n\nreturn {\n  json: {\n    productId: originalData.productId || originalData.originalProduct?.id,\n    productTitle: originalData.title,\n    occasions: occasions,\n    parseError: parseError,\n    originalProduct: originalData.originalProduct\n  }\n};"}},{"id":"shopify-update-metafield","name":"üîü Shopify - MAJ Metafield","type":"n8n-nodes-base.shopify","typeVersion":1,"position":[2040,300],"parameters":{"resource":"product","operation":"update","productId":"={{ $json.productId }}","updateFields":{"metafieldsUi":{"metafieldValues":[{"namespace":"custom","key":"occasions","value":"={{ JSON.stringify($json.occasions) }}","type":"list.single_line_text_field"}]}}},"credentials":{"shopifyApi":{"id":"SHOPIFY_CREDENTIAL_ID","name":"Mon Shopify"}},"continueOnFail":true,"retryOnFail":true,"maxTries":3,"waitBetweenTries":2000},{"id":"log-success","name":"1Ô∏è‚É£1Ô∏è‚É£ Log Succ√®s","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2240,300],"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","value":"SUCCESS","type":"string"},{"id":"productId","name":"productId","value":"={{ $json.productId }}","type":"string"},{"id":"occasions","name":"occasions","value":"={{ $json.occasions }}","type":"object"}]}}},{"id":"log-skip","name":"1Ô∏è‚É£2Ô∏è‚É£ Log Skip","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1440,500],"parameters":{"assignments":{"assignments":[{"id":"status","name":"status","value":"SKIPPED","type":"string"},{"id":"productId","name":"productId","value":"={{ $json.productId }}","type":"string"},{"id":"reason","name":"skipReason","value":"={{ \"Titre vide: \" + !$json.title + \", Type vide: \" + !$json.productType + \", Vendeur vide: \" + !$json.vendor + \", Mots insuffisants: \" + ($json.wordCount < 100) }}","type":"string"}]}}},{"id":"merge-results","name":"1Ô∏è‚É£3Ô∏è‚É£ Merge R√©sultats","type":"n8n-nodes-base.merge","typeVersion":3,"position":[2440,400],"parameters":{"mode":"append","options":{}}}],"connections":{"manual-trigger":{"main":[[{"node":"create-loop","type":"main","index":0}]]},"create-loop":{"main":[[{"node":"loop-batches","type":"main","index":0}]]},"loop-batches":{"main":[[{"node":"shopify-get-product","type":"main","index":0}],[{"node":"merge-results","type":"main","index":1}]]},"shopify-get-product":{"main":[[{"node":"extract-data","type":"main","index":0}]]},"extract-data":{"main":[[{"node":"filter-strict","type":"main","index":0}]]},"filter-strict":{"main":[[{"node":"build-ai-prompt","type":"main","index":0}],[{"node":"log-skip","type":"main","index":0}]]},"build-ai-prompt":{"main":[[{"node":"ai-classify","type":"main","index":0}]]},"ai-classify":{"main":[[{"node":"parse-ai-response","type":"main","index":0}]]},"parse-ai-response":{"main":[[{"node":"shopify-update-metafield","type":"main","index":0}]]},"shopify-update-metafield":{"main":[[{"node":"log-success","type":"main","index":0}]]},"log-success":{"main":[[{"node":"loop-batches","type":"main","index":0}]]},"log-skip":{"main":[[{"node":"loop-batches","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"5c29b9bd-82ea-4b0d-a8a8-a24d1835f775","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-30T11:08:49.267Z","createdAt":"2026-01-30T11:08:49.267Z","role":"workflow:owner","workflowId":"JoBLUPy2jmTwVLao","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-02-04T16:23:15.727Z","createdAt":"2026-01-28T16:28:14.007Z","id":"XaROBSQFx0D84zZf","name":"Andrew 1 - Pinterest Image Generator","active":false,"isArchived":false,"nodes":[{"parameters":{"jsCode":"// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// üé® PINTEREST IMAGE GENERATOR - CONFIGURATION\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n// üìä PARAM√àTRES G√âN√âRAUX\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst MAX_PRODUCTS_TO_GENERATE = 20;\nconst MIN_PRICE_EUR = 90;\nconst LIMIT_PRODUCTS_FETCH = 250;  // Maximum Shopify API limit (was 350)\n\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n// üéØ R√àGLES G√âN√âRALES DU PROMPT (s'appliquent √† TOUTES les marques)\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst PROMPT_RULES = {\n  // Focus produit - LE SAC DOIT √äTRE VISIBLE ET CENTRAL\n  productFocus: `\n    The bag must be the MAIN FOCAL POINT of the image.\n    Product prominently displayed in foreground, never tiny or distant.\n    Model holding bag forward at waist level OR wearing it on shoulder in first plan.\n    The bag should occupy significant visual space - this is a product photo with lifestyle context.\n  `,\n\n  // Coh√©rence produit - NE PAS MODIFIER LE PRODUIT\n  productCoherence: `\n    CRITICAL: Use the EXACT product from the reference image.\n    Do NOT modify, alter, or reimagine the product design.\n    Maintain perfect visual coherence with original product details, colors, textures, and hardware.\n    The bag must look identical to the source image.\n  `,\n\n  // Pose mannequin - √âVITER LE REGARD CAM√âRA\n  modelPose: `\n    Model should have face partially hidden, turned away, or cropped out.\n    NO direct eye contact with camera - avoid stock photo look.\n    Prefer natural movement: walking, reaching, candid gesture.\n    Anonymous model so viewer can project themselves.\n  `,\n\n  // Qualit√© technique\n  technicalQuality: `\n    Professional fashion photography, Canon EOS R5 85mm f/1.4.\n    Natural daylight, golden hour preferred.\n    Shallow depth of field with soft bokeh background.\n    Warm natural color grading, editorial magazine quality.\n    NO text, NO watermarks, NO visible brand logos.\n  `,\n\n  // Format Pinterest\n  pinterestFormat: `\n    Vertical 2:3 aspect ratio for Pinterest mobile optimization.\n    --ar 2:3\n  `\n};\n\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n// üé® PROMPTS PAR MARQUE (sc√®ne/contexte sp√©cifique √† chaque marque)\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst BRAND_PROMPTS = {\n  'Lancaster': {\n    scene: 'elegant French woman 30s walking on pristine alpine lake dock, soft cashmere sweater and tailored trousers, golden hour morning light, misty mountain peaks background',\n    style: 'refined Parisian elegance, understated luxury'\n  },\n  'Valentino Bags': {\n    scene: 'sophisticated woman 35 on luxury coastal resort terrace, flowing linen dress cream tones, Mediterranean golden afternoon light, turquoise ocean vista',\n    style: 'Italian glamour, effortless sophistication'\n  },\n  'Lancel': {\n    scene: 'chic Parisian woman 38 at alpine chalet wooden terrace, classic cashmere coat, soft winter morning light, snow-covered peaks',\n    style: 'French heritage, timeless elegance'\n  },\n  'Michael Kors': {\n    scene: 'confident woman 32 on luxury yacht deck, sophisticated nautical outfit, bright coastal sunlight, azure water',\n    style: 'American glamour, jet-set lifestyle'\n  },\n  'Pinko': {\n    scene: 'fashionable woman 28 at boutique ski resort terrace, modern apres-ski outfit, crisp mountain sunlight, panoramic alpine vista',\n    style: 'Italian contemporary fashion, bold femininity'\n  },\n  'Karl Lagerfeld': {\n    scene: 'elegant woman 33 on designer beach club lounger, monochrome chic outfit black and white, dramatic coastal light',\n    style: 'Parisian avant-garde, minimalist luxury'\n  },\n  'Furla': {\n    scene: 'sophisticated woman 30 lakeside villa terrace Como, soft Italian linen outfit, diffused afternoon light, stone balustrade',\n    style: 'Italian craftsmanship, colorful elegance'\n  },\n  'Lacoste': {\n    scene: 'athletic woman 30 at prestigious tennis club terrace, sporty-chic outfit white and green, bright natural daylight',\n    style: 'French sporting heritage, relaxed elegance'\n  },\n  'Guess': {\n    scene: 'stylish woman 28 rooftop terrace Manhattan, trendy urban outfit, golden hour cityscape',\n    style: 'American denim culture, youthful glamour'\n  },\n  'Eastpak': {\n    scene: 'teenager 16 exploring forest hiking trail, casual outdoor gear, dappled natural forest light',\n    style: 'urban explorer, authentic adventure'\n  },\n  'Chabrand': {\n    scene: 'young man 25 on Mediterranean coastal cliff path, casual French Riviera style, warm golden hour light',\n    style: 'French Riviera casual, masculine elegance'\n  },\n  'Anekke': {\n    scene: 'bohemian woman 28 vintage outdoor market, eclectic boho outfit pastels, warm afternoon sunlight',\n    style: 'artistic bohemian, unique patterns and colors'\n  },\n  'David William': {\n    scene: 'modern man 32 urban park natural setting, casual contemporary outfit, soft natural light',\n    style: 'contemporary masculinity, everyday refinement'\n  },\n  'Cherry Paris': {\n    scene: 'chic Parisian woman 26 Luxembourg Gardens, romantic feminine outfit pastels, soft overcast Parisian light',\n    style: 'Parisian romance, feminine delicacy'\n  },\n  'Francinel': {\n    scene: 'distinguished man 40 in Provence vineyard, refined casual French style, warm afternoon sun',\n    style: 'French heritage leather goods, classic masculinity'\n  },\n  'Arthur & Aston': {\n    scene: 'sophisticated man 35 at classic French cafe terrace, smart casual linen shirt and chinos, warm afternoon Parisian light',\n    style: 'French artisanal leather, timeless masculine elegance'\n  }\n};\n\n// Alias pour Valentino\nBRAND_PROMPTS['Valentino'] = BRAND_PROMPTS['Valentino Bags'];\n\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n// üé® MAPPING COULEURS (fran√ßais -> anglais descriptif)\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst COLOR_MAP = {\n  'Noir': 'sleek black leather',\n  'Marron': 'rich cognac brown leather',\n  'Cognac': 'warm cognac tan leather',\n  'Beige': 'soft beige cream leather',\n  'Camel': 'luxurious camel tan leather',\n  'Rouge': 'elegant burgundy red leather',\n  'Bordeaux': 'deep bordeaux wine leather',\n  'Bleu': 'refined navy blue leather',\n  'Bleu Marine': 'classic navy blue leather',\n  'Vert': 'sophisticated forest green leather',\n  'Gris': 'contemporary stone grey leather',\n  'Blanc': 'pristine cream white leather',\n  'Rose': 'delicate blush pink leather',\n  'Jaune': 'vibrant honey yellow leather',\n  'Orange': 'warm terracotta orange leather',\n  'Taupe': 'elegant taupe leather',\n  'Nude': 'subtle nude beige leather',\n  'Gold': 'metallic gold accent leather',\n  'Silver': 'metallic silver accent leather'\n};\n\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n// üîß TEMPLATE DE PROMPT FINAL\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄÔøΩÔøΩ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconst PROMPT_TEMPLATE = `\n{BRAND_SCENE}\nCarrying a beautiful {PRODUCT_TYPE} in {COLOR_DESC}.\n{PRODUCT_FOCUS}\n{PRODUCT_COHERENCE}\n{MODEL_POSE}\n{TECHNICAL_QUALITY}\n{PINTEREST_FORMAT}\n`;\n\n// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\nconsole.log('üìã Configuration:');\nconsole.log('  ‚Ä¢ Max images: ' + MAX_PRODUCTS_TO_GENERATE);\nconsole.log('  ‚Ä¢ Prix min: ' + MIN_PRICE_EUR + '‚Ç¨');\nconsole.log('  ‚Ä¢ Limite fetch: ' + LIMIT_PRODUCTS_FETCH);\nconsole.log('  ‚Ä¢ Marques configur√©es: ' + Object.keys(BRAND_PROMPTS).length);\nconsole.log('  ‚Ä¢ Couleurs mapp√©es: ' + Object.keys(COLOR_MAP).length);\n\n// Initialize pagination tracking\n$execution.customData.set('batch_num', '0');\n$execution.customData.set('last_product_id', '');\n$execution.customData.set('generated', '0');\n$execution.customData.set('skipped', '0');\n$execution.customData.set('total_fetched', '0');\n\nconsole.log('üîÑ Pagination initialized');\n\nreturn [{\n  json: {\n    MAX_PRODUCTS_TO_GENERATE,\n    MIN_PRICE_EUR,\n    LIMIT_PRODUCTS_FETCH,\n    PROMPT_RULES,\n    PROMPT_TEMPLATE,\n    BRAND_PROMPTS,\n    COLOR_MAP,\n    SHOPIFY_DOMAIN: 'luckybagdrancy.myshopify.com'\n  }\n}];"},"id":"903f1e55-a98d-46d9-8b15-a49a4ddc75e8","name":"‚öôÔ∏è CONFIG","type":"n8n-nodes-base.code","typeVersion":2,"position":[224,-464]},{"parameters":{"method":"POST","url":"https://luckybagdrancy.myshopify.com/admin/api/2024-01/graphql.json","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ {\n  \"query\": \"query getProducts($first: Int!, $after: String, $query: String!) { products(first: $first, after: $after, query: $query) { pageInfo { hasNextPage endCursor } edges { cursor node { id legacyResourceId handle title vendor productType status tags variants(first: 10) { edges { node { id legacyResourceId price inventoryQuantity displayName } } } images(first: 1) { edges { node { url altText } } } } } } }\",\n  \"variables\": {\n    \"first\": 250,\n    \"after\": $json.after || null,\n    \"query\": \"status:ACTIVE AND variants.price:>\" + $('‚öôÔ∏è CONFIG').first().json.MIN_PRICE_EUR\n  }\n} }}","options":{}},"id":"42f3c585-717b-44a8-9b4b-25a6dbce061f","name":"üõçÔ∏è Shopify GraphQL","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[672,-752],"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}}},{"parameters":{"jsCode":"const config = $('‚öôÔ∏è CONFIG').first().json;\nconst minPrice = config.MIN_PRICE_EUR;\nconst brandPrompts = config.BRAND_PROMPTS;\nconst maxToGenerate = config.MAX_PRODUCTS_TO_GENERATE;\n\nconst items = $input.all();\nconst validProducts = [];\nconst missingBrands = [];\n\nconst rejected = {\n  inactive: 0, noImage: 0, noStock: 0, priceTooLow: 0, missingBrand: 0, noVendor: 0\n};\n\nconsole.log('üì¶ Filtering ' + items.length + ' products...');\n\nfor (const item of items) {\n  const p = item.json;\n\n  if (!p.vendor || p.vendor.trim() === '') { rejected.noVendor++; continue; }\n  if (p.status && p.status !== 'ACTIVE' && p.status !== 'active') { rejected.inactive++; continue; }\n\n  const variants = p.variants || [];\n  const images = p.images || [];\n  const mainImageUrl = images[0]?.src || images[0]?.url;\n  if (!variants.length || !mainImageUrl) { rejected.noImage++; continue; }\n\n  const stock = variants.reduce((sum, v) => sum + (v.inventory_quantity || 0), 0);\n  if (stock < 1) { rejected.noStock++; continue; }\n\n  const price = parseFloat(variants[0].price || 0);\n  if (price <= minPrice) { rejected.priceTooLow++; continue; }\n\n  let brand = p.vendor;\n  let brandKey = brand === 'Valentino' ? 'Valentino Bags' : brand;\n  if (!brandPrompts[brandKey]) {\n    rejected.missingBrand++;\n    if (brand && !missingBrands.includes(brand)) missingBrands.push(brand);\n    continue;\n  }\n\n  const v = variants[0];\n  validProducts.push({\n    product_id: String(p.id),\n    handle: p.handle || 'unknown',\n    brand: brand,\n    product_type: p.product_type || 'Sac',\n    color: v.option1 || v.option2 || v.option3 || '',\n    price: price,\n    main_image_url: mainImageUrl,\n    tags: p.tags || [],\n    gender: p.gender || 'woman'\n  });\n}\n\nconsole.log('');\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê R√âSULTAT DU FILTRAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\nconsole.log('‚úÖ Produits VALIDES: ' + validProducts.length);\n\nconst totalRejected = Object.values(rejected).reduce((a, b) => a + b, 0);\nconsole.log('‚ùå Produits REJET√âS: ' + totalRejected);\n\n// Log gender distribution\nconst genderCount = {man: 0, woman: 0, unisex: 0};\nvalidProducts.forEach(p => genderCount[p.gender]++);\nconsole.log('');\nconsole.log('üë§ Distribution genre:');\nconsole.log('   ‚Ä¢ Homme: ' + genderCount.man);\nconsole.log('   ‚Ä¢ Femme: ' + genderCount.woman);\nconsole.log('   ‚Ä¢ Mixte: ' + genderCount.unisex);\n\nif (missingBrands.length > 0) {\n  console.log('');\n  console.log('‚ö†Ô∏è Marques sans prompt: ' + missingBrands.join(', '));\n}\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n\nif (validProducts.length === 0) {\n  console.log('‚ùå Aucun produit valide');\n  return [];\n}\n\n$execution.customData.set('max', String(maxToGenerate));\n$execution.customData.set('generated', $execution.customData.get('generated') || '0');\n$execution.customData.set('skipped', $execution.customData.get('skipped') || '0');\n$execution.customData.set('missing', missingBrands.join(','));\n\nconst totalFetched = parseInt($execution.customData.get('total_fetched') || '0');\n$execution.customData.set('total_fetched', String(totalFetched + items.length));\n\n// CORRECTION: Retourner TOUS les produits valides (pas de limite artificielle)\n// Permet de traiter tous les 250 produits avant de fetch les prochains\n\nconsole.log('üíæ Returning ' + validProducts.length + ' products (ALL valid products from batch)');\n\nreturn validProducts.map(p => ({ json: p }));"},"id":"d8cdd917-f30b-499a-b8f6-1633e944f561","name":"üîç Filter Products","type":"n8n-nodes-base.code","typeVersion":2,"position":[1120,-752]},{"parameters":{"jsCode":"// üé® Build Prompt - v9.1 - PR√âSERVATION DESIGN + PETITE MAROQUINERIE\n\nconst productData = $json;\nconst { product_id, handle, brand, product_type, color, price, main_image_url, gender, tags } = productData;\n\nconsole.log('üé® Building prompt for: ' + handle);\nconsole.log('üë§ Gender: ' + gender);\nconsole.log('üì¶ Type: ' + product_type);\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// üîç D√âTECTION PETITE MAROQUINERIE\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nconst SMALL_LEATHER_GOODS = [\n  'portefeuille', 'wallet', 'porte-carte', 'cardholder', 'card holder',\n  'porte-monnaie', 'coin purse', 'porte-cl√©', 'key holder',\n  '√©tui', 'etui', 'case', 'pochette'\n];\n\nconst typeLC = (product_type || '').toLowerCase();\nconst isSmallLeatherGoods = SMALL_LEATHER_GOODS.some(keyword => typeLC.includes(keyword));\n\nconsole.log('üîé Small leather goods: ' + isSmallLeatherGoods);\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// üé® SC√àNES PAR MARQUE\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nconst BRAND_SCENES = {\n  'Lancaster': {\n    woman: { scene: 'Elegant woman on alpine lake dock', outfit: 'cashmere sweater, tailored trousers' },\n    man: { scene: 'Sophisticated man on alpine lake dock', outfit: 'wool coat, smart casual' },\n    vibe: 'Parisian elegance'\n  },\n  'Valentino Bags': {\n    woman: { scene: 'Glamorous woman on Mediterranean terrace', outfit: 'flowing cream dress' },\n    man: { scene: 'Stylish man on Mediterranean terrace', outfit: 'linen suit' },\n    vibe: 'Italian glamour'\n  },\n  'Valentino': {\n    woman: { scene: 'Glamorous woman on Mediterranean terrace', outfit: 'flowing cream dress' },\n    man: { scene: 'Stylish man on Mediterranean terrace', outfit: 'linen suit' },\n    vibe: 'Italian glamour'\n  },\n  'Lancel': {\n    woman: { scene: 'Chic woman at alpine chalet', outfit: 'classic cashmere coat' },\n    man: { scene: 'Distinguished man at alpine chalet', outfit: 'elegant overcoat' },\n    vibe: 'French heritage'\n  },\n  'Michael Kors': {\n    woman: { scene: 'Confident woman on yacht deck', outfit: 'nautical chic' },\n    man: { scene: 'Confident man on yacht deck', outfit: 'smart nautical style' },\n    vibe: 'American jet-set'\n  },\n  'Pinko': {\n    woman: { scene: 'Fashionable woman at ski resort', outfit: 'modern apres-ski' },\n    man: { scene: 'Trendy man at ski resort', outfit: 'modern winter style' },\n    vibe: 'Italian boldness'\n  },\n  'Karl Lagerfeld': {\n    woman: { scene: 'Elegant woman at beach club', outfit: 'monochrome black and white' },\n    man: { scene: 'Stylish man at beach club', outfit: 'monochrome black and white' },\n    vibe: 'Parisian avant-garde'\n  },\n  'Furla': {\n    woman: { scene: 'Sophisticated woman at Lake Como', outfit: 'soft Italian linen' },\n    man: { scene: 'Refined man at Lake Como', outfit: 'Italian summer style' },\n    vibe: 'Italian craftsmanship'\n  },\n  'Lacoste': {\n    woman: { scene: 'Athletic woman at tennis club', outfit: 'sporty-chic white and green' },\n    man: { scene: 'Athletic man at tennis club', outfit: 'sporty-chic polo style' },\n    vibe: 'French sporting elegance'\n  },\n  'Guess': {\n    woman: { scene: 'Stylish woman on rooftop', outfit: 'trendy urban outfit' },\n    man: { scene: 'Cool man on rooftop', outfit: 'trendy urban style' },\n    vibe: 'American youthful glamour'\n  },\n  'Eastpak': {\n    woman: { scene: 'Young woman on hiking trail', outfit: 'casual outdoor gear' },\n    man: { scene: 'Young man on hiking trail', outfit: 'casual outdoor gear' },\n    vibe: 'Urban explorer'\n  },\n  'Chabrand': {\n    woman: { scene: 'Chic woman on coastal path', outfit: 'French Riviera casual' },\n    man: { scene: 'Young man on coastal path', outfit: 'French Riviera casual' },\n    vibe: 'Masculine elegance'\n  },\n  'Anekke': {\n    woman: { scene: 'Bohemian woman at vintage market', outfit: 'eclectic boho pastels' },\n    man: { scene: 'Artistic man at vintage market', outfit: 'bohemian casual' },\n    vibe: 'Artistic spirit'\n  },\n  'David William': {\n    woman: { scene: 'Modern woman in urban park', outfit: 'casual contemporary' },\n    man: { scene: 'Modern man in urban park', outfit: 'casual contemporary' },\n    vibe: 'Everyday refinement'\n  },\n  'Cherry Paris': {\n    woman: { scene: 'Romantic woman in Luxembourg Gardens', outfit: 'feminine pastels' },\n    man: { scene: 'Elegant man in Luxembourg Gardens', outfit: 'smart Parisian style' },\n    vibe: 'Parisian romance'\n  },\n  'Francinel': {\n    woman: { scene: 'Elegant woman in Provence vineyard', outfit: 'refined French style' },\n    man: { scene: 'Distinguished man in Provence vineyard', outfit: 'refined French casual' },\n    vibe: 'Classic heritage'\n  },\n  'Arthur & Aston': {\n    woman: { scene: 'Sophisticated woman at French cafe', outfit: 'smart casual linen' },\n    man: { scene: 'Sophisticated man at French cafe', outfit: 'smart casual linen' },\n    vibe: 'Timeless masculine elegance'\n  }\n};\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// üé® COLOR MAPPING\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nconst COLOR_MAP = {\n  'Noir': 'black', 'noir': 'black', 'Black': 'black',\n  'Blanc': 'white', 'blanc': 'white', 'White': 'white',\n  'Rouge': 'red', 'rouge': 'red', 'Red': 'red',\n  'Bleu': 'blue', 'bleu': 'blue', 'Blue': 'blue',\n  'Vert': 'green', 'vert': 'green', 'Green': 'green',\n  'Rose': 'pink', 'rose': 'pink', 'Pink': 'pink',\n  'Marron': 'brown', 'marron': 'brown', 'Brown': 'brown',\n  'Gris': 'gray', 'gris': 'gray', 'Gray': 'gray',\n  'Beige': 'beige', 'Camel': 'camel',\n  'Dor√©': 'gold', 'Gold': 'gold',\n  'Argent√©': 'silver', 'Silver': 'silver'\n};\n\nconst colorEn = COLOR_MAP[color] || color || '';\n\n// R√©cup√©rer la config de la marque\nlet brandKey = brand;\nif (brand === 'Valentino' && !BRAND_SCENES[brand]) {\n  brandKey = 'Valentino Bags';\n}\n\nconst brandConfig = BRAND_SCENES[brandKey];\nif (!brandConfig) {\n  throw new Error('Brand \"' + brand + '\" not configured');\n}\n\n// Choisir la sc√®ne selon le genre\nlet genderKey = gender || 'woman';\nif (genderKey === 'unisex') {\n  genderKey = Math.random() > 0.5 ? 'woman' : 'man';\n}\n\nconst sceneConfig = brandConfig[genderKey] || brandConfig['woman'];\nconst personType = genderKey === 'man' ? 'man' : 'woman';\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// üéØ PROMPT v9.1 - ADAPTATION SELON TYPE PRODUIT\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nlet prompt;\n\nif (isSmallLeatherGoods) {\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  // PETITE MAROQUINERIE ‚Üí ZOOM MAIN/POCHE\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  prompt = [\n    // Sc√®ne et contexte\n    sceneConfig.scene + ', golden hour natural light.',\n    'Wearing ' + sceneConfig.outfit + '.',\n\n    // üî¥ CADRAGE VISAGE\n    'FRAMING: Camera angle shows person from nose/mouth level downward.',\n    'CRITICAL RULE: Frame CUTS BELOW the eyes. Show only from nose tip or mouth downward.',\n    'Head can be: turned away, tilted down, in profile, OR back view.',\n    'NEVER show eyes in frame.',\n\n    // üî¥ PETITE MAROQUINERIE - ZOOM MAIN/POCHE\n    'CLOSE-UP SHOT: ' + product_type + (colorEn ? ' in ' + colorEn : '') + ' held elegantly in hand.',\n    'Hand positioned at waist/hip level OR placing the item in pocket.',\n    'ZOOM focus on the product: show texture, stitching, hardware, logo details.',\n    'The product occupies 55-65% of frame - prominent and clearly visible.',\n\n    // üî¥üî¥üî¥ PR√âSERVATION DESIGN (R√âP√âT√â 3X)\n    'STEP 1: ANALYZE the reference image carefully. Study every detail.',\n    'STEP 2: RECREATE the EXACT product from reference. Same design, same proportions.',\n    'CRITICAL: This is NOT a creative task. COPY the product exactly as shown.',\n    'DO NOT modify: shape, size, hardware, logo, stitching, texture.',\n    'DO NOT add: embellishments, patterns, or decorative elements not in reference.',\n    'DO NOT change: color, material appearance, or any design feature.',\n\n    // Style et qualit√©\n    brandConfig.vibe + ' aesthetic. Editorial fashion photography.',\n    'Professional lifestyle shot. Soft bokeh background.',\n    '2:3 vertical format for Pinterest.'\n  ].join(' ');\n\n} else {\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  // SAC NORMAL ‚Üí PORT√â SUR CORPS\n  // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n  prompt = [\n    // Sc√®ne et contexte\n    sceneConfig.scene + ', golden hour natural light.',\n    'Wearing ' + sceneConfig.outfit + '.',\n\n    // üî¥ CADRAGE VISAGE\n    'FRAMING: Camera angle shows person from nose/mouth level downward.',\n    'CRITICAL RULE: Frame CUTS BELOW the eyes. Show only from nose tip or mouth downward.',\n    'Head can be: turned away, tilted down, in profile, OR back view.',\n    'NEVER show eyes in frame.',\n\n    // üî¥ SAC PORT√â\n    'WEARING the ' + product_type + (colorEn ? ' in ' + colorEn : '') + ' properly on body.',\n    'Bag is CARRIED/WORN on shoulder, crossbody, or arm - NOT held in hands.',\n    'Natural carrying position as intended for this bag style.',\n\n    // Prominence du produit\n    'PRODUCT FOCUS: The bag occupies 45-55% of frame, clearly visible.',\n    'Product is the HERO of the image, prominently displayed.',\n\n    // üî¥üî¥üî¥ PR√âSERVATION DESIGN (R√âP√âT√â 3X)\n    'STEP 1: ANALYZE the reference image carefully. Study every detail.',\n    'STEP 2: RECREATE the EXACT product from reference. Same design, same proportions.',\n    'CRITICAL: This is NOT a creative task. COPY the product exactly as shown.',\n    'DO NOT modify: shape, size, hardware, logo, stitching, texture.',\n    'DO NOT add: embellishments, patterns, or decorative elements not in reference.',\n    'DO NOT change: color, material appearance, or any design feature.',\n\n    // Style et qualit√©\n    brandConfig.vibe + ' aesthetic. Editorial fashion photography.',\n    'Professional lifestyle shot. Soft bokeh background.',\n    '2:3 vertical format for Pinterest.'\n  ].join(' ');\n}\n\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n// üìù ALT TEXT SEO\n// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nconst genderLabel = gender === 'man' ? 'men' : (gender === 'unisex' ? 'unisex' : 'women');\nconst alt_text = brand + ' ' + product_type + (colorEn ? ' ' + colorEn : '') + ' for ' + genderLabel + ' - ' + brandConfig.vibe + ' lifestyle photo';\n\nconsole.log('üìè Prompt length: ' + prompt.length + ' chars');\nconsole.log('üìù Alt text: ' + alt_text);\nconsole.log('');\nconsole.log('üéØ v9.1 MODE: ' + (isSmallLeatherGoods ? 'PETITE MAROQUINERIE (zoom main)' : 'SAC (port√© corps)'));\n\nreturn [{\n  json: {\n    product_id,\n    handle,\n    brand,\n    product_type,\n    color: colorEn,\n    price,\n    gender,\n    prompt,\n    alt_text,\n    image_urls: [main_image_url],\n    model: 'nano-banana-pro',\n    quality: 'high',\n    width: 1000,\n    height: 1500,\n    main_image_url\n  }\n}];"},"id":"all-in-one-node","name":"üé® Build Prompt","type":"n8n-nodes-base.code","typeVersion":2,"position":[2688,-912]},{"parameters":{"method":"POST","url":"https://api.kie.ai/api/v1/jobs/createTask","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"nano-banana-pro\",\n  \"input\": {\n    \"prompt\": \"{{ $json.prompt }}\",\n    \"image_input\": [\"{{ $json.main_image_url }}\"],\n    \"aspect_ratio\": \"2:3\",\n    \"quality\": \"high\"\n  }\n}","options":{}},"id":"c7c39eb3-0501-436d-b571-1f8047bc7895","name":"ü§ñ kie.ai - Create","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[2912,-912],"credentials":{"httpHeaderAuth":{"id":"IICo6klxlhcvloXU","name":"Header Auth account"}}},{"parameters":{"url":"=https://api.kie.ai/api/v1/jobs/recordInfo?taskId={{ $json.data?.taskId || $json.taskId }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"id":"a8874e93-6b85-4e97-8853-52d0aa555756","name":"üîç kie.ai - Poll","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[3360,-912],"credentials":{"httpHeaderAuth":{"id":"IICo6klxlhcvloXU","name":"Header Auth account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":false},"conditions":[{"leftValue":"={{ ($json.data?.state || $json.state || '').toString().toLowerCase().trim() }}","rightValue":"success","operator":{"type":"string","operation":"equals"}}],"combinator":"and"},"options":{}},"id":"a9d639a7-8b62-4db6-8962-64457196e792","name":"‚úÖ Success?","type":"n8n-nodes-base.if","typeVersion":2,"position":[3584,-912]},{"parameters":{"amount":30,"unit":"seconds"},"id":"748075b6-780d-442c-9560-e785066c5687","name":"‚è≥ Wait Retry","type":"n8n-nodes-base.wait","typeVersion":1,"position":[3808,-720],"webhookId":"wait-retry"},{"parameters":{"jsCode":"const r = $json.data?.resultJson || $json.resultJson;\r\nconst parsed = typeof r === 'string' ? JSON.parse(r) : r;\r\nconst imageUrl = parsed?.resultUrls?.[0] || parsed?.url || parsed?.output_url;\r\nif (!imageUrl) throw new Error('No image URL');\r\n\r\nconst p = $('üé® Build Prompt').item.json;\r\nreturn [{\r\n  json: {\r\n    product_id: p.product_id,\r\n    handle: p.handle,\r\n    brand: p.brand,\r\n    imageUrl: imageUrl,\r\n    filename: `${p.handle}-pinterest.jpg`\r\n  },\r\n  pairedItem: { item: 0 }\r\n}];\r\n"},"id":"9cc45334-576e-482a-97d8-dc8884f68c10","name":"üìé Extract URL","type":"n8n-nodes-base.code","typeVersion":2,"position":[3808,-912]},{"parameters":{"method":"POST","url":"https://luckybagdrancy.myshopify.com/admin/api/2024-01/graphql.json","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"mutation fileCreate($files: [FileCreateInput!]!) { fileCreate(files: $files) { files { id alt createdAt fileStatus updatedAt ... on MediaImage { id image { altText url width height } } } userErrors { code field message } } }\",\n  \"variables\": {\n    \"files\": [\n      {\n        \"alt\": \"{{ $json.alt_text }}\",\n        \"contentType\": \"IMAGE\",\n        \"originalSource\": \"{{ $json.imageUrl }}\"\n      }\n    ]\n  }\n}","options":{}},"id":"e385ef98-d877-4ae3-b3d5-b5936a7a816f","name":"üì§ Upload Image to Shopify Files","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[4704,-912],"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}}},{"parameters":{"amount":10,"unit":"seconds"},"id":"38ddc793-c167-45e0-bcc3-9dc67fff998d","name":"‚è≥ Wait File Processing","type":"n8n-nodes-base.wait","typeVersion":1,"position":[4928,-912],"webhookId":"wait-file-processing"},{"parameters":{"method":"POST","url":"https://luckybagdrancy.myshopify.com/admin/api/2024-01/graphql.json","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"query\": \"query getFile($id: ID!) { node(id: $id) { ... on MediaImage { id fileStatus image { url } } } }\",\n  \"variables\": {\n    \"id\": \"{{ $('üì§ Upload Image to Shopify Files').item.json.data.fileCreate.files[0].id }}\"\n  }\n}","options":{}},"id":"poll-shopify-file-status","name":"üîç Poll Shopify File Status","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[5152,-912],"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}}},{"parameters":{"jsCode":"const nodeData = $json.data?.node;\nif (!nodeData) throw new Error('No node data in response');\n\nconst fileStatus = nodeData.fileStatus;\nif (fileStatus !== 'READY') {\n  throw new Error(`File not ready yet. Status: ${fileStatus}`);\n}\n\nconst imageUrl = nodeData.image?.url;\nif (!imageUrl) {\n  throw new Error('No image URL found in file response');\n}\n\n// Get data from Extract Cloudinary URL (which has product info and alt_text)\nconst cloudinaryData = $('üìé Extract Cloudinary URL').item.json;\n\nreturn [{\n  json: {\n    product_id: cloudinaryData.product_id,\n    handle: cloudinaryData.handle,\n    brand: cloudinaryData.brand,\n    alt_text: cloudinaryData.alt_text,  // ‚Üê AJOUT√â!\n    pinterest_image_url: imageUrl,\n    shopify_file_id: nodeData.id\n  },\n  pairedItem: { item: 0 }\n}];"},"id":"2c609bd5-3366-4523-90de-a1b849afc486","name":"üìé Extract Shopify File URL","type":"n8n-nodes-base.code","typeVersion":2,"position":[5376,-912]},{"parameters":{"method":"POST","url":"=https://luckybagdrancy.myshopify.com/admin/api/2024-01/products/{{ $json.product_id }}/metafields.json","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyOAuth2Api","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"metafield\": {\n    \"namespace\": \"custom\",\n    \"key\": \"pinterest_image\",\n    \"value\": \"{{ $json.pinterest_image_url }}\",\n    \"type\": \"single_line_text_field\"\n  }\n}","options":{}},"id":"553c5547-eebf-4366-9585-737456f87f35","name":"üíæ Update Metafield","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[5600,-912],"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}}},{"parameters":{"amount":0.5,"unit":"seconds"},"id":"7c43ec1b-a459-4bcf-b702-228e7b510a50","name":"‚è≥ Rate Limit","type":"n8n-nodes-base.wait","typeVersion":1,"position":[5824,-912],"webhookId":"rate-limit"},{"parameters":{"jsCode":"// Image generated successfully\nconst generated = parseInt($execution.customData.get('generated') || '0');\nconst newGenerated = generated + 1;\n$execution.customData.set('generated', String(newGenerated));\n\nconst max = parseInt($execution.customData.get('max') || '2');\nconsole.log('‚úÖ SUCCESS - Generated: ' + newGenerated + '/' + max);\n\nif (newGenerated >= max) {\n  console.log('üéâ MAX ATTEINT! Toutes les images g√©n√©r√©es (' + newGenerated + '/' + max + ')');\n}\n\n// Return 1 item to continue the loop\nreturn [{json: {_success: true}}];"},"id":"341edc9e-f493-4e22-aaaa-65bfd45deec5","name":"‚úÖ Success","type":"n8n-nodes-base.code","typeVersion":2,"position":[6048,-752]},{"parameters":{"jsCode":"// Final summary when all batches processed\nconst generated = parseInt($execution.customData.get('generated') || '0');\nconst skipped = parseInt($execution.customData.get('skipped') || '0');\nconst max = parseInt($execution.customData.get('max') || '2');\nconst missing = ($execution.customData.get('missing') || '').split(',').filter(x => x);\nconst batchNum = parseInt($execution.customData.get('batch_num') || '0');\nconst totalFetched = parseInt($execution.customData.get('total_fetched') || '0');\n\nconsole.log('');\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\nconsole.log('           üéâ WORKFLOW TERMIN√â');\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\nconsole.log('üì¶ Batches Shopify trait√©s: ' + batchNum);\nconsole.log('üìä Total produits fetch√©s: ' + totalFetched);\nconsole.log('‚úÖ Images g√©n√©r√©es: ' + generated + '/' + max);\nconsole.log('‚è≠Ô∏è Skipped (Pinterest existait): ' + skipped);\nconsole.log('üìä Total trait√©s: ' + (generated + skipped));\n\nif (missing.length > 0) {\n  console.log('');\n  console.log('‚ö†Ô∏è Marques sans prompt: ' + missing.join(', '));\n}\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\n\nreturn [{\n  json: {\n    status: 'completed',\n    generated,\n    skipped,\n    max,\n    batches: batchNum,\n    total_fetched: totalFetched,\n    missing_brands: missing\n  }\n}];"},"id":"final-summary","name":"üìä Final Summary","type":"n8n-nodes-base.code","typeVersion":2,"position":[2016,-1296]},{"parameters":{"amount":30,"unit":"seconds"},"id":"4664af11-3cf9-4c56-b255-ec23c3ec6f7e","name":"‚è≥ Wait 30sec","type":"n8n-nodes-base.wait","typeVersion":1,"position":[3136,-912],"webhookId":"wait-2min"},{"parameters":{"url":"=https://luckybagdrancy.myshopify.com/admin/api/2024-01/products/{{ $json.product_id }}/metafields.json?namespace=custom&key=pinterest_image","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyOAuth2Api","options":{"response":{"response":{"neverError":true}}}},"id":"435c7642-725a-4fc4-9e3b-ddb9b1a34701","name":"üîç Check Pinterest Exists","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[2016,-1104],"credentials":{"shopifyOAuth2Api":{"id":"VniaQQuQc9LfrLh8","name":"Shopify account"}}},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.metafields?.[0]?.value }}","operation":"isNotEmpty"}]}},"id":"bbf5ae1e-9b7c-4610-aaa2-ce1bef088ed6","name":"üö´ Has Pinterest?","type":"n8n-nodes-base.if","typeVersion":1,"position":[2464,-1104]},{"parameters":{"jsCode":"// Product already has Pinterest - skip it\r\nconst skipped = parseInt($execution.customData.get('skipped') || '0');\r\n$execution.customData.set('skipped', String(skipped + 1));\r\n\r\nconst handle = $json.handle || 'unknown';\r\nconsole.log('‚è≠Ô∏è SKIP: ' + handle + ' - Pinterest existe d√©j√†');\r\n\r\n// Return 1 item to continue the loop (Split In Batches needs data to continue)\r\nreturn [{json: {_skipped: true}}];\r\n"},"id":"e85c5d9b-3da9-4d85-9ebb-419360b51485","name":"‚è≠Ô∏è Skip","type":"n8n-nodes-base.code","typeVersion":2,"position":[2688,-1104]},{"parameters":{"jsCode":"// üñºÔ∏è Prepare Cloudinary - Pr√©pare le fichier avec alt_text depuis Build Prompt\nconst buildPromptData = $('üé® Build Prompt').first().json;\nconst { product_id, handle, brand, product_type, color, imageUrl, alt_text } = $json;\n\n// Nettoyer les valeurs pour le SEO\nconst cleanBrand = (brand || '').toLowerCase().replace(/[^a-z0-9]+/g, '-');\nconst cleanType = (product_type || 'product').toLowerCase().replace(/[^a-z0-9]+/g, '-');\nconst cleanColor = (color || '').toLowerCase().replace(/[^a-z0-9]+/g, '-');\n\n// Format: brand-type-color-lifestyle-pinterest.jpg\nconst filename = cleanBrand + '-' + cleanType + (cleanColor ? '-' + cleanColor : '') + '-lifestyle-pinterest.jpg';\n\n// R√©cup√©rer alt_text depuis Build Prompt ou g√©n√©rer un fallback\nconst finalAltText = buildPromptData.alt_text || alt_text || (brand + ' ' + product_type + ' lifestyle photo');\n\nconsole.log('üñºÔ∏è Preparing: ' + filename);\nconsole.log('üìù Alt text: ' + finalAltText);\n\nreturn [{\n  json: {\n    product_id,\n    handle,\n    brand,\n    product_type,\n    color,\n    imageUrl,\n    filename,\n    alt_text: finalAltText,\n    folder: 'pinterest-lifestyle'\n  }\n}];"},"id":"cloudinary-prepare-1769766631630","name":"üñºÔ∏è Prepare Cloudinary","type":"n8n-nodes-base.code","typeVersion":2,"position":[4032,-912]},{"parameters":{"method":"POST","url":"https://api.cloudinary.com/v1_1/dfvqgzgww/image/upload","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendBody":true,"specifyBody":"json","jsonBody":"={{ {\n  file: $json.imageUrl,\n  public_id: \"pinterest-lifestyle/\" + $json.handle + \"-lifestyle-pinterest\",\n  transformation: \"c_fill,w_1000,h_1500,q_80\",\n  format: \"jpg\",\n  overwrite: true\n} }}","options":{}},"id":"cloudinary-upload-1769766631630","name":"‚òÅÔ∏è Cloudinary Upload","type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[4256,-912],"credentials":{"httpBasicAuth":{"id":"CNFLkjVrkWTWzhDo","name":"Cloudinary API"}}},{"parameters":{"jsCode":"const response = $json || {};\nconst prepareData = $('üñºÔ∏è Prepare Cloudinary').first().json || {};\n\nconsole.log('üìé Extracting Cloudinary URL...');\n\nif (response.error) {\n  throw new Error('Cloudinary error: ' + (response.error.message || JSON.stringify(response.error)));\n}\n\nconst cloudinaryUrl = response.secure_url || response.url || '';\nif (!cloudinaryUrl) {\n  throw new Error('Cloudinary upload failed - no URL returned');\n}\n\nconst originalSize = response.bytes || 0;\nconst width = response.width || 0;\nconst height = response.height || 0;\n\nconsole.log('‚úÖ Cloudinary upload successful');\nconsole.log('üìê Dimensions: ' + width + 'x' + height);\nconsole.log('üì¶ Size: ' + Math.round(originalSize / 1024) + ' KB');\nconsole.log('üìù Alt text: ' + (prepareData.alt_text || 'none'));\n\nreturn [{\n  json: {\n    product_id: String(prepareData.product_id || ''),\n    handle: String(prepareData.handle || ''),\n    brand: String(prepareData.brand || ''),\n    imageUrl: String(cloudinaryUrl),\n    alt_text: String(prepareData.alt_text || ''),\n    filename: String(prepareData.filename || ''),\n    cloudinary_size_kb: Math.round(originalSize / 1024),\n    cloudinary_dimensions: width + 'x' + height\n  }\n}];"},"id":"cloudinary-extract-1769766631630","name":"üìé Extract Cloudinary URL","type":"n8n-nodes-base.code","typeVersion":2,"position":[4480,-912]},{"parameters":{},"id":"manual-trigger-restored","name":"Manual Trigger","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,-480]},{"parameters":{"batchSize":1,"options":{}},"id":"split-1769785423045","name":"üîÑ Loop Items","type":"n8n-nodes-base.splitInBatches","typeVersion":2,"position":[1344,-752]},{"parameters":{"jsCode":"// üéØ Check Max - V√©rifie si on continue ou termine\nconst generated = parseInt($execution.customData.get('generated') || '0');\nconst max = parseInt($execution.customData.get('max') || '0');\n\n// L'item courant vient de Split In Batches dans $json\nconst productData = $json;\n\nconsole.log('üìä Check: generated=' + generated + '/' + max);\n\n// V√©rifier si on a atteint le maximum d'images √† g√©n√©rer\nif (generated >= max) {\n  console.log('üèÅ DONE: Max atteint (' + generated + '/' + max + ') - STOP processing');\n  console.log('‚è≠Ô∏è Skipping product: ' + (productData.handle || 'unknown'));\n  return [{json: {done: true, reason: 'max_reached'}}];\n}\n\n// V√©rifier que les donn√©es du produit sont valides\nif (!productData.product_id || !productData.brand) {\n  console.log('‚ùå ERROR: Invalid product data - missing product_id or brand');\n  console.log('   product_id: ' + (productData.product_id || 'undefined'));\n  console.log('   brand: ' + (productData.brand || 'undefined'));\n  console.log('   handle: ' + (productData.handle || 'undefined'));\n  return [{json: {done: true, reason: 'invalid_data'}}];\n}\n\nconsole.log('‚û°Ô∏è Process: ' + productData.handle + ' (' + productData.brand + ')');\n\n// Continuer avec ce produit\nreturn [{\n  json: {\n    done: false,\n    ...productData\n  }\n}];"},"id":"checkmax-1769785423045","name":"üéØ Check Max","type":"n8n-nodes-base.code","typeVersion":2,"position":[1568,-1056]},{"parameters":{"jsCode":"// üîÄ Merge Product Data - Fusionne metafields avec les donn√©es produit\n// Probl√®me: HTTP Request node √©crase les donn√©es d'entr√©e\n// Solution: R√©cup√©rer les donn√©es depuis Check Max et fusionner\n\nconst metafields = $json.metafields || [];\nconst productData = $('üéØ Check Max').item.json;\n\n// Fusionner les donn√©es\nreturn [{\n  json: {\n    ...productData,\n    metafields\n  }\n}];"},"id":"merge-product-data-1769805042274","name":"üîÄ Merge Product Data","type":"n8n-nodes-base.code","typeVersion":2,"position":[2240,-1104]},{"parameters":{"jsCode":"// üîÅ Shopify Batch Loop - Contr√¥le le fetch par batch de 250 avec GraphQL cursor\nconst config = $('‚öôÔ∏è CONFIG').first().json;\nconst maxToGenerate = config.MAX_PRODUCTS_TO_GENERATE;\nconst generated = parseInt($execution.customData.get('generated') || '0');\nconst skipped = parseInt($execution.customData.get('skipped') || '0');\n\n// Incr√©menter le num√©ro de batch\nlet batchNum = parseInt($execution.customData.get('batch_num') || '0');\nbatchNum++;\n$execution.customData.set('batch_num', String(batchNum));\n\n// IMPORTANT: Ce node ne devrait √™tre atteint QUE si generated < max\n// Si on arrive ici avec generated >= max, c'est une erreur de logique\nif (generated >= maxToGenerate) {\n  console.log('‚ùå ERREUR LOGIQUE: Batch Loop appel√© alors que max atteint!');\n  console.log('   Generated: ' + generated + '/' + maxToGenerate);\n  return [{json: {done: true, reason: 'error_max_already_reached'}}];\n}\n\n// V√©rifier s'il reste des produits √† fetcher\nconst hasNextPage = $execution.customData.get('has_next_page') === 'true';\nif (batchNum > 1 && !hasNextPage) {\n  console.log('');\n  console.log('‚ö†Ô∏è PLUS DE PRODUITS SHOPIFY - Termin√© avec ' + generated + '/' + maxToGenerate);\n  return [{json: {done: true, reason: 'no_more_products'}}];\n}\n\n// Calculer combien il reste √† g√©n√©rer\nconst remaining = maxToGenerate - generated;\n\nconsole.log('');\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\nconsole.log('üîÅ BATCH SHOPIFY #' + batchNum);\nconsole.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');\nconsole.log('üìä Progression: ' + generated + '/' + maxToGenerate + ' g√©n√©r√©es');\nconsole.log('üìä Skipped: ' + skipped);\nconsole.log('üéØ Encore besoin de: ' + remaining + ' images');\nconsole.log('üì¶ Fetching next 250 products with GraphQL filter...');\nconsole.log('üîç Query: status:ACTIVE AND variants.price:>' + config.MIN_PRICE_EUR);\n\n// R√©cup√©rer le cursor pour pagination\nconst afterCursor = batchNum > 1 ? $execution.customData.get('after_cursor') : null;\n\nreturn [{\n  json: {\n    batch_num: batchNum,\n    after: afterCursor,\n    remaining: remaining,\n    min_price: config.MIN_PRICE_EUR\n  }\n}];"},"id":"shopify-batch-loop-1769813534985","name":"üîÅ Shopify Batch Loop","type":"n8n-nodes-base.code","typeVersion":2,"position":[448,-480]},{"parameters":{"jsCode":"// üèÅ Batch Done? - D√©cide si continuer avec un nouveau batch ou terminer\n\nconst generated = parseInt($execution.customData.get('generated') || '0');\nconst max = parseInt($execution.customData.get('max') || '2');\nconst hasNextPage = $execution.customData.get('has_next_page') === 'true';\nconst batchNum = parseInt($execution.customData.get('batch_num') || '0');\n\nconsole.log('');\nconsole.log('üèÅ Batch #' + batchNum + ' termin√© - V√©rification...');\nconsole.log('   Images g√©n√©r√©es: ' + generated + '/' + max);\nconsole.log('   Shopify has more: ' + hasNextPage);\n\n// R√àGLE 1: Si max atteint ‚Üí TERMINER\nif (generated >= max) {\n  console.log('‚úÖ MAX ATTEINT ‚Üí Going to Final Summary');\n  return [{\n    json: {\n      should_continue: false,\n      reason: 'max_reached',\n      generated: generated,\n      max: max\n    }\n  }];\n}\n\n// R√àGLE 2: Si max pas atteint ET plus de produits Shopify ‚Üí CONTINUER\nif (hasNextPage) {\n  console.log('‚è≠Ô∏è MAX PAS ATTEINT + More products available ‚Üí Fetching next batch');\n  return [{\n    json: {\n      should_continue: true,\n      reason: 'need_more_products',\n      generated: generated,\n      max: max,\n      remaining: max - generated\n    }\n  }];\n}\n\n// R√àGLE 3: Si max pas atteint ET plus de produits Shopify ‚Üí TERMINER\nconsole.log('‚ö†Ô∏è MAX PAS ATTEINT mais plus de produits Shopify ‚Üí Going to Final Summary');\nreturn [{\n  json: {\n    should_continue: false,\n    reason: 'no_more_products',\n    generated: generated,\n    max: max\n  }\n}];"},"id":"check-batch-done-1769813534986","name":"üèÅ Batch Done?","type":"n8n-nodes-base.code","typeVersion":2,"position":[1568,-1296]},{"parameters":{"jsCode":"// üì¶ Transform GraphQL Response - Avec TAGS pour genre\nconst response = $json;\nconst edges = response.data?.products?.edges || [];\nconst pageInfo = response.data?.products?.pageInfo || {};\n\nconsole.log('üì¶ GraphQL response: ' + edges.length + ' products');\nconsole.log('üìÑ Has next page: ' + pageInfo.hasNextPage);\n\nif (pageInfo.endCursor) {\n  $execution.customData.set('after_cursor', pageInfo.endCursor);\n}\n$execution.customData.set('has_next_page', String(pageInfo.hasNextPage || false));\n\nconst products = edges.map(edge => {\n  const node = edge.node;\n  const variants = (node.variants?.edges || []).map(v => v.node);\n  const images = (node.images?.edges || []).map(i => i.node);\n\n  // R√©cup√©rer les tags et d√©terminer le genre\n  const tags = node.tags || [];\n  const tagsLower = tags.map(t => t.toLowerCase());\n\n  let gender = 'woman'; // D√©faut: femme\n  const hasHomme = tagsLower.some(t => t.includes('homme') || t.includes('man') || t.includes('men'));\n  const hasFemme = tagsLower.some(t => t.includes('femme') || t.includes('woman') || t.includes('women'));\n\n  if (hasHomme && hasFemme) {\n    gender = 'unisex';\n  } else if (hasHomme) {\n    gender = 'man';\n  } else if (hasFemme) {\n    gender = 'woman';\n  }\n\n  return {\n    id: node.legacyResourceId,\n    handle: node.handle || '',\n    title: node.title || '',\n    vendor: node.vendor || '',\n    product_type: node.productType || '',\n    status: node.status || '',\n    tags: tags,\n    gender: gender,\n    variants: variants.map(v => ({\n      id: v.legacyResourceId,\n      price: v.price || '0',\n      inventory_quantity: v.inventoryQuantity || 0,\n      option1: v.displayName?.split(' / ')[0] || '',\n      option2: v.displayName?.split(' / ')[1] || '',\n      option3: v.displayName?.split(' / ')[2] || ''\n    })),\n    images: images.map(img => ({\n      src: img.url || '',\n      url: img.url || '',\n      alt: img.altText || ''\n    }))\n  };\n});\n\nconsole.log('‚úÖ Transformed ' + products.length + ' products with gender detection');\n\nif (products.length > 0) {\n  console.log('üîç First product: ' + products[0].handle + ' (gender: ' + products[0].gender + ')');\n}\n\nreturn products.map(p => ({json: p}));"},"id":"transform-graphql-1769813818980","name":"üì¶ Transform GraphQL","type":"n8n-nodes-base.code","typeVersion":2,"position":[896,-752]},{"parameters":{"conditions":{"options":{"caseSensitive":false},"conditions":[{"leftValue":"={{ $json.done }}","rightValue":"true","operator":{"type":"boolean","operation":"true"}}],"combinator":"and"},"options":{}},"id":"check-max-done-1769818069883","name":"‚úã Max Reached?","type":"n8n-nodes-base.if","typeVersion":2,"position":[1792,-1056]},{"parameters":{"jsCode":"// ‚è≠Ô∏è Skip to Loop - Retourne √† Loop Items sans traiter\nconsole.log('‚è≠Ô∏è Returning to loop without processing this item');\nreturn [{json: {_skipped_max_reached: true}}];"},"id":"skip-to-loop-1769818069883","name":"‚è≠Ô∏è Skip to Loop","type":"n8n-nodes-base.code","typeVersion":2,"position":[2016,-800]},{"parameters":{"conditions":{"options":{"caseSensitive":false},"conditions":[{"leftValue":"={{ $json.should_continue }}","rightValue":"true","operator":{"type":"boolean","operation":"true"}}],"combinator":"and"},"options":{}},"id":"should-continue-1769818469779","name":"üîÑ Should Continue?","type":"n8n-nodes-base.if","typeVersion":2,"position":[1792,-1296]}],"connections":{"Manual Trigger":{"main":[[{"node":"‚öôÔ∏è CONFIG","type":"main","index":0}]]},"‚öôÔ∏è CONFIG":{"main":[[{"node":"üîÅ Shopify Batch Loop","type":"main","index":0}]]},"üîÅ Shopify Batch Loop":{"main":[[{"node":"üõçÔ∏è Shopify GraphQL","type":"main","index":0}]]},"Shopify - Get Products":{"main":[[{"node":"üîç Filter Products","type":"main","index":0}]]},"üîç Filter Products":{"main":[[{"node":"üîÑ Loop Items","type":"main","index":0}]]},"üîÑ Loop Items":{"main":[[{"node":"üéØ Check Max","type":"main","index":0}],[{"node":"üèÅ Batch Done?","type":"main","index":0}]]},"üèÅ Batch Done?":{"main":[[{"node":"üîÑ Should Continue?","type":"main","index":0}]]},"üéØ Check Max":{"main":[[{"node":"‚úã Max Reached?","type":"main","index":0}]]},"üîç Check Pinterest Exists":{"main":[[{"node":"üîÄ Merge Product Data","type":"main","index":0}]]},"üîÄ Merge Product Data":{"main":[[{"node":"üö´ Has Pinterest?","type":"main","index":0}]]},"üö´ Has Pinterest?":{"main":[[{"node":"‚è≠Ô∏è Skip","type":"main","index":0}],[{"node":"üé® Build Prompt","type":"main","index":0}]]},"‚è≠Ô∏è Skip":{"main":[[{"node":"üîÑ Loop Items","type":"main","index":0}]]},"üé® Build Prompt":{"main":[[{"node":"ü§ñ kie.ai - Create","type":"main","index":0}]]},"ü§ñ kie.ai - Create":{"main":[[{"node":"‚è≥ Wait 30sec","type":"main","index":0}]]},"‚è≥ Wait 30sec":{"main":[[{"node":"üîç kie.ai - Poll","type":"main","index":0}]]},"üîç kie.ai - Poll":{"main":[[{"node":"‚úÖ Success?","type":"main","index":0}]]},"‚úÖ Success?":{"main":[[{"node":"üìé Extract URL","type":"main","index":0}],[{"node":"‚è≥ Wait Retry","type":"main","index":0}]]},"‚è≥ Wait Retry":{"main":[[{"node":"üîç kie.ai - Poll","type":"main","index":0}]]},"üìé Extract URL":{"main":[[{"node":"üñºÔ∏è Prepare Cloudinary","type":"main","index":0}]]},"üñºÔ∏è Prepare Cloudinary":{"main":[[{"node":"‚òÅÔ∏è Cloudinary Upload","type":"main","index":0}]]},"‚òÅÔ∏è Cloudinary Upload":{"main":[[{"node":"üìé Extract Cloudinary URL","type":"main","index":0}]]},"üìé Extract Cloudinary URL":{"main":[[{"node":"üì§ Upload Image to Shopify Files","type":"main","index":0}]]},"üì§ Upload Image to Shopify Files":{"main":[[{"node":"‚è≥ Wait File Processing","type":"main","index":0}]]},"‚è≥ Wait File Processing":{"main":[[{"node":"üîç Poll Shopify File Status","type":"main","index":0}]]},"üîç Poll Shopify File Status":{"main":[[{"node":"üìé Extract Shopify File URL","type":"main","index":0}]]},"üìé Extract Shopify File URL":{"main":[[{"node":"üíæ Update Metafield","type":"main","index":0}]]},"üíæ Update Metafield":{"main":[[{"node":"‚è≥ Rate Limit","type":"main","index":0}]]},"‚è≥ Rate Limit":{"main":[[{"node":"‚úÖ Success","type":"main","index":0}]]},"‚úÖ Success":{"main":[[{"node":"üîÑ Loop Items","type":"main","index":0}]]},"üõçÔ∏è Shopify GraphQL":{"main":[[{"node":"üì¶ Transform GraphQL","type":"main","index":0}]]},"üì¶ Transform GraphQL":{"main":[[{"node":"üîç Filter Products","type":"main","index":0}]]},"‚úã Max Reached?":{"main":[[{"node":"‚è≠Ô∏è Skip to Loop","type":"main","index":0}],[{"node":"üîç Check Pinterest Exists","type":"main","index":0}]]},"‚è≠Ô∏è Skip to Loop":{"main":[[{"node":"üîÑ Loop Items","type":"main","index":0}]]},"üîÑ Should Continue?":{"main":[[{"node":"üîÅ Shopify Batch Loop","type":"main","index":0}],[{"node":"üìä Final Summary","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":null,"pinData":{"Manual Trigger":[{"json":{},"pairedItem":{"item":0}}]},"versionId":"250c2b5e-db2c-4828-a41d-c14dd2053419","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-28T16:28:14.010Z","createdAt":"2026-01-28T16:28:14.010Z","role":"workflow:owner","workflowId":"XaROBSQFx0D84zZf","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-02-02T16:18:39.920Z","createdAt":"2026-02-02T16:18:39.920Z","id":"l5WkOmISUBQ0pHnPf7xKV","name":"AI agent chat","active":false,"isArchived":false,"nodes":[{"parameters":{"options":{}},"id":"ef4c6982-f746-4d48-944b-449f8bdbb69f","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","position":[368,240],"webhookId":"53c136fe-3e77-4709-a143-fe82746dd8b6","typeVersion":1.1},{"parameters":{},"id":"e6183978-5077-4252-9718-6b36b6a7cd74","name":"Simple Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[720,464],"typeVersion":1.3},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"id":"1719e956-f9c8-48f5-9744-ee62345a9f7d","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[576,464],"typeVersion":1.2},{"parameters":{"options":{}},"id":"f0815af7-da61-4863-9cfa-b35be836b59c","name":"SerpAPI","type":"@n8n/n8n-nodes-langchain.toolSerpApi","position":[848,464],"typeVersion":1},{"parameters":{"options":{}},"id":"2d3b4012-bd5f-46d5-be6d-af1ede6c155b","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[608,240],"typeVersion":1.8}],"connections":{"SerpAPI":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateId":"1954"},"pinData":{},"versionId":"caa68f67-8e35-4d73-a342-e9da0c804994","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-02-02T16:18:39.922Z","createdAt":"2026-02-02T16:18:39.922Z","role":"workflow:owner","workflowId":"l5WkOmISUBQ0pHnPf7xKV","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-26T15:33:38.876Z","createdAt":"2026-01-26T15:33:38.876Z","id":"uA8N0WuuKGxQbWyOmGSnz","name":"Turn new Shopify products into SEO blogs with Perplexity, Gemini and Sheets","active":false,"isArchived":false,"nodes":[{"parameters":{"authentication":"accessToken","topic":"products/create"},"id":"8e280a53-57a8-4c12-86dd-97e798c66331","name":"Shopify Trigger","type":"n8n-nodes-base.shopifyTrigger","position":[912,288],"webhookId":"4f8bc1e9-bc1c-455b-b2cb-654c14cfb032","typeVersion":1},{"parameters":{"options":{}},"id":"587ad810-2aad-442f-97e5-a24f98061213","name":"Gemini","type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","position":[1408,560],"typeVersion":1},{"parameters":{},"id":"b7f595c6-b559-40db-bb00-51a6e00a6296","name":"No Operation","type":"n8n-nodes-base.noOp","position":[2032,880],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"e738b77a-5be6-41db-a1d1-481a20c238e5","name":"id","type":"number","value":"={{ $json.id }}"},{"id":"1bf7b574-db76-4911-a1bf-fe19ecd88359","name":"title","type":"string","value":"={{ $json.title }}"},{"id":"6559c586-2357-4147-9b60-094fb4c82e34","name":"body_html","type":"string","value":"={{ $json.body_html }}"},{"id":"3c4db7aa-291c-4853-b1ce-eddfc1af2e2c","name":"vendor","type":"string","value":"={{ $json.vendor }}"},{"id":"7528aeef-64cc-480f-abd5-f35b6d277f7b","name":"product_type","type":"string","value":"={{ $json.product_type }}"},{"id":"0b6681bd-6ac9-44f2-8f7b-11a3d7d29343","name":"handle","type":"string","value":"={{ $json.handle }}"},{"id":"4445023b-733e-43c8-a289-2f690ff26735","name":"images","type":"string","value":"={{ $json.images[0].src }}"}]},"options":{}},"id":"3915596c-927c-4cd5-951c-f626bb98d5e0","name":"input set","type":"n8n-nodes-base.set","position":[1120,288],"typeVersion":3.4},{"parameters":{"operation":"append","documentId":{"__rl":true,"mode":"list","value":"1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit?usp=drivesdk","cachedResultName":"shopify_to_blog"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit#gid=0","cachedResultName":"data"},"columns":{"value":{"id":"={{ $json.id }}","title":"={{ $json.title }}","handle":"={{ $json.handle }}","images":"={{ $json.images }}","status":"product data","vendor":"={{ $json.vendor }}","body_html":"={{ $json.body_html }}","product_type":"={{ $json.product_type }}"},"schema":[{"id":"id","type":"string","display":true,"removed":false,"required":false,"displayName":"id","defaultMatch":true,"canBeUsedToMatch":true},{"id":"title","type":"string","display":true,"removed":false,"required":false,"displayName":"title","defaultMatch":false,"canBeUsedToMatch":true},{"id":"body_html","type":"string","display":true,"removed":false,"required":false,"displayName":"body_html","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ai_blog","type":"string","display":true,"removed":true,"required":false,"displayName":"ai_blog","defaultMatch":false,"canBeUsedToMatch":true},{"id":"vendor","type":"string","display":true,"removed":false,"required":false,"displayName":"vendor","defaultMatch":false,"canBeUsedToMatch":true},{"id":"product_type","type":"string","display":true,"removed":false,"required":false,"displayName":"product_type","defaultMatch":false,"canBeUsedToMatch":true},{"id":"handle","type":"string","display":true,"removed":false,"required":false,"displayName":"handle","defaultMatch":false,"canBeUsedToMatch":true},{"id":"images","type":"string","display":true,"removed":false,"required":false,"displayName":"images","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"string","display":true,"removed":false,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["id"],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"e2d01126-c96f-4b30-b1ba-d029aa092cbc","name":"input update","type":"n8n-nodes-base.googleSheets","position":[1344,288],"typeVersion":4.7},{"parameters":{"messages":{"message":[{"content":"=# You are an e‚Äëcommerce market researcher and SEO strategist.\n\n## Use the following Shopify product data as your only ground truth:\nTitle: {{ $json.title }}\nDescription (HTML): {{ $json.body_html }}\nVendor / Brand: {{ $json.vendor }}\nProduct type / Category: {{ $json.product_type }}\n\n## Your task is to analyze this product conceptually and return structured research that another AI agent will later use to write a blog post.\nDo not write the blog post itself.\n\n## Focus your reasoning on:\n- The problem this product solves and why customers look for it.\n- The typical target audience and their priorities.\n- Common use cases and real‚Äëworld situations where the product is helpful.\n- Key features and the benefits those features deliver.\n- Likely objections or questions customers might have before buying.\n- Search‚Äëintent and SEO opportunities around this type of product.\n\n## Return your findings as the following JSON object:\n\njson\n{\n  \"productSummary\": \"2-3 sentence neutral summary of what this product is and what it does.\",\n  \"targetAudience\": [\n    \"Short description of a key audience segment\",\n    \"Another audience segment\"\n  ],\n  \"customerGoals\": [\n    \"What customers want to achieve by buying this product\"\n  ],\n  \"painPoints\": [\n    \"3‚Äì7 concrete problems or frustrations this product helps solve\"\n  ],\n  \"usageScenarios\": [\n    \"3‚Äì7 realistic situations where the product is used\"\n  ],\n  \"featureToBenefitMap\": [\n    {\n      \"feature\": \"Name or description of a feature\",\n      \"benefit\": \"Why this matters to the customer in practical terms\"\n    }\n  ],\n  \"objectionsAndConcerns\": [\n    \"3‚Äì7 likely doubts, risks, or questions customers might have before purchase\"\n  ],\n  \"faqIdeas\": [\n    \"5‚Äì10 good FAQ questions a shopper would ask about this type of product\"\n  ],\n  \"seoResearch\": {\n    \"searchIntent\": \"Short description of the main search intent for this product type (informational, commercial, transactional, etc.).\",\n    \"primaryKeyword\": \"One main keyword phrase you infer for this product.\",\n    \"secondaryKeywords\": [\n      \"3‚Äì10 related and long‚Äëtail keyword ideas\"\n    ],\n    \"contentAngleIdeas\": [\n      \"3‚Äì7 potential blog angles or headlines themes (not full titles, just angles).\"\n    ]\n  }\n}\n\n## Rules:\n- Base your reasoning on the product data and general domain knowledge about similar products.\n- Do not fabricate highly specific technical specs if they are not implied; keep assumptions generic and reasonable.\n- Do not output a blog article or paragraphs of prose.\n- Respond only with valid JSON matching the schema above, no extra commentary."}]},"simplify":true,"options":{},"requestOptions":{}},"id":"01b46429-b331-4775-86e2-16ee0cd26b27","name":"web search","type":"n8n-nodes-base.perplexity","position":[1616,288],"typeVersion":1},{"parameters":{"promptType":"define","text":"=## Input Data\nYou are given:\n\nproduct_title : {{ $('input update').item.json.title }}\nproduct_description (HTML from Shopify) : {{ $('input update').item.json.body_html }}\nbrand_name : {{ $('input update').item.json.vendor }}\nproduct_type : {{ $('input update').item.json.product_type }}\nwebsearch_data (research summary about this product/type) : {{ $json.message }}","hasOutputParser":true,"options":{"systemMessage":"=# AI Agent Prompt for Structured Product Blog Generator\n\nYou are an expert automotive copywriter and e‚Äëcommerce content strategist.  \nYour task is to generate a structured JSON object for a product-focused article, following strict length and formatting rules.\n\n## Use all of this information to understand:\n- What the product is.  \n- Who it is for.  \n- What problems it solves for professional users (e.g., mechanics, technicians, workshop owners, or relevant audience based on product_type).  \n- How it compares to typical alternatives in the market.\n\n## Required Output Structure\nYou must return a **single JSON object** with **exactly** these fields and constraints:\n\n{\n  \"article_title\": \"\",\n  \"introduction\": \"\",\n  \"problem_title\": \"\",\n  \"problem_paragraph\": \"\",\n  \"problem_pointers\": [\n    {\n      \"name\": \"\",\n      \"value\": \"\"\n    }\n  ],\n  \"solution_title\": \"\",\n  \"solution_paragraph\": \"\",\n  \"features_and_benefits\": [\n    {\n      \"name\": \"\",\n      \"value\": \"\"\n    }\n  ],\n  \"technical_specifications\": [\n    {\n      \"name\": \"\",\n      \"value\": \"\"\n    }\n  ],\n  \"real_life_usage\": [\n    {\n      \"title\": \"\",\n      \"description\": \"\",\n      \"points\": [\n        {\n          \"name\": \"\",\n          \"value\": \"\"\n        }\n      ]\n    }\n  ],\n  \"comparative_advantage\": [\n    {\n      \"factor\": \"\",\n      \"this_product\": \"\",\n      \"others\": \"\"\n    }\n  ],\n  \"recommendations_and_cta\": {\n    \"title\": \"\",\n    \"description\": \"\"\n  }\n}\n\n## Field Specifications & Limits\n### 1. article_title\n- Start with **product name** (use product_title and brand_name)  \n- Add short descriptive hook  \n- **Max: 100 characters or 15 words**  \nExample: \"Autel MaxiCOM Ultra Lite Review: The One Diagnostic Tool Your Workshop Needs?\"\n\n### 2. introduction\n- 1 short paragraph introducing main problem + solution hint  \n- **Max: 400 characters or 60‚Äì70 words**\n\n### 3. problem_title\n- Short, problem-focused heading  \n- **Max: 100 characters or 15 words**  \nExample: \"The Core Problem: The Diagnostic Dilemma for Modern Mechanics\"\n\n### 4. problem_paragraph\n- 1 paragraph explaining core problem  \n- **Max: 400 characters or 60‚Äì70 words**\n\n### 5. problem_pointers (3‚Äì5 items)\nEach:\nname: 2‚Äì3 words\nvalue: Max 150 characters\n**Example:**\n[\n  {\"name\": \"Time Waste\", \n    \"value\": \"Without precise diagnostics, hours are lost on trial-and-error instead of efficient repairs.\"\n  },\n  {\"name\": \"Customer Dissatisfaction\", \n  \"value\": \"Inaccurate diagnoses lead to repeat repairs, eroding trust and damaging reputation.\"\n  }\n]\n\n### 6. solution_title\n- Introduces product as solution  \n- **Max: 100 characters or 15 words**\n\n### 7. solution_paragraph\n- Presents product as practical solution  \n- **Max: 500 characters or 100 words**\n\n### 8. features_and_benefits (5‚Äì7 items)\nEach:\nname: 3‚Äì5 words max\nvalue: Max 150 characters (feature + benefit)\n\n### 9. technical_specifications (5‚Äì7 items)\nEach:\nname: 1‚Äì2 words\nvalue: 50‚Äì70 characters\n**Example:**\n[\n  {\n  \"name\": \"Connectivity\", \n  \"value\": \"Fast XP200 Platform with 2.4/5Ghz dual-band Wi-Fi\"\n  },\n  {\"name\": \"Display\", \n    \"value\": \"7-inch capacitive touchscreen for workshop use\"\n  }\n]\n\n### 10. real_life_usage (2‚Äì3 scenarios)\nEach scenario:\ntitle: 5‚Äì10 words\ndescription: Max 70 characters\npoints: 3‚Äì5 items (name: 2‚Äì3 words, value: 60‚Äì100 characters)\n\n### 11. comparative_advantage (7‚Äì10 items)\nEach:\nfactor: 2‚Äì4 words\nthis_product: 1 concise line\nothers: 1 concise line about competitors\n\n### 12. recommendations_and_cta\ntitle: 7‚Äì10 words\ndescription: 120‚Äì150 characters\n\n## Rules\n- Use actual product name, brand, type from inputs  \n- Professional, problem‚Äìsolution tone like Autel example  \n- Use websearch_data to enrich features/use cases  \n- **Return ONLY valid JSON** - no extra text/comments  \n- Respect all character limits strictly"}},"id":"47a37577-cbde-4d34-b326-4fe76c644d1a","name":"content generator","type":"@n8n/n8n-nodes-langchain.agent","position":[1920,288],"typeVersion":3.1},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $now.minute }}"},"id":"f542a85c-5675-438c-8d80-93d76c0d3f70","name":"Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[1504,560],"typeVersion":1.3},{"parameters":{"options":{}},"id":"cf68bc52-f847-47a1-b437-3856eb615027","name":"Output Parser1","type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","position":[1632,560],"typeVersion":1},{"parameters":{"options":{}},"id":"47bd077c-7178-4347-944f-ebead1607016","name":"Gemini3","type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","position":[1936,560],"typeVersion":1},{"parameters":{"schemaType":"manual","inputSchema":"{\n  \"article_title\": \"\",\n  \"introduction\": \"\",\n  \"problem_title\": \"\",\n  \"problem_paragraph\": \"\",\n  \"problem_pointers\": [\n    {\n      \"name\": \"\",\n      \"value\": \"\"\n    }\n  ],\n  \"solution_title\": \"\",\n  \"solution_paragraph\": \"\",\n  \"features_and_benefits\": [\n    {\n      \"name\": \"\",\n      \"value\": \"\"\n    }\n  ],\n  \"technical_specifications\": [\n    {\n      \"name\": \"\",\n      \"value\": \"\"\n    }\n  ],\n  \"real_life_usage\": [\n    {\n      \"title\": \"\",\n      \"description\": \"\",\n      \"points\": [\n        {\n          \"name\": \"\",\n          \"value\": \"\"\n        }\n      ]\n    }\n  ],\n  \"comparative_advantage\": [\n    {\n      \"factor\": \"\",\n      \"this_product\": \"\",\n      \"others\": \"\"\n    }\n  ],\n  \"recommendations_and_cta\": {\n    \"title\": \"\",\n    \"description\": \"\"\n  }\n}"},"id":"6652db78-962d-4aa7-ae7e-3f7c26eb26cb","name":"Structured","type":"@n8n/n8n-nodes-langchain.outputParserStructured","position":[2048,560],"typeVersion":1.3},{"parameters":{"documentId":{"__rl":true,"mode":"list","value":"1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit?usp=drivesdk","cachedResultName":"shopify_to_blog"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit#gid=0","cachedResultName":"data"},"filtersUI":{"values":[{"lookupColumn":"status","lookupValue":"blog generated"}]},"options":{}},"id":"e90f6621-222b-4983-94b1-1099cb83e671","name":"get product data","type":"n8n-nodes-base.googleSheets","position":[1328,880],"typeVersion":4.7},{"parameters":{"method":"POST","url":"https://{store_id}.myshopify.com/admin/api/2025-07/blogs/118631235877/articles.json","authentication":"predefinedCredentialType","nodeCredentialType":"shopifyAccessTokenApi","sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"article\": {\n    \"title\": \"{{ $('HTML structuring').item.json.article.title }}\",\n    \"author\": \"{{ $json.vendor }}\",\n    \"tags\": \"Electronics\",\n    \"body_html\": \"{{ $json.ai_blog }}\",\n    \"published_at\": \"{{$now}}\"\n  }\n}\n","options":{}},"id":"94413cf5-1514-4ab0-9ec1-b3302bc587a3","name":"article creation","type":"n8n-nodes-base.httpRequest","position":[1600,880],"typeVersion":4.2},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"list","value":"1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit?usp=drivesdk","cachedResultName":"shopify_to_blog"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit#gid=0","cachedResultName":"data"},"columns":{"value":{"id":"={{ $('input update').item.json.id }}","status":"posted"},"schema":[{"id":"id","type":"string","display":true,"removed":false,"required":false,"displayName":"id","defaultMatch":true,"canBeUsedToMatch":true},{"id":"title","type":"string","display":true,"removed":true,"required":false,"displayName":"title","defaultMatch":false,"canBeUsedToMatch":true},{"id":"body_html","type":"string","display":true,"removed":true,"required":false,"displayName":"body_html","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ai_blog","type":"string","display":true,"removed":true,"required":false,"displayName":"ai_blog","defaultMatch":false,"canBeUsedToMatch":true},{"id":"vendor","type":"string","display":true,"removed":true,"required":false,"displayName":"vendor","defaultMatch":false,"canBeUsedToMatch":true},{"id":"product_type","type":"string","display":true,"removed":true,"required":false,"displayName":"product_type","defaultMatch":false,"canBeUsedToMatch":true},{"id":"handle","type":"string","display":true,"removed":true,"required":false,"displayName":"handle","defaultMatch":false,"canBeUsedToMatch":true},{"id":"images","type":"string","display":true,"removed":true,"required":false,"displayName":"images","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"string","display":true,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"row_number","type":"number","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"row_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["id"],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"650e20c5-ff2c-4754-aad4-7f7777b0d19b","name":"update blog post status","type":"n8n-nodes-base.googleSheets","position":[1824,880],"typeVersion":4.7},{"parameters":{"jsCode":"// Extract data from AI Agent AND Shopify product node\nconst aiData = $input.first().json.output;\nconst productData = $('input update').first().json;\n\n// Get the first product image URL (Shopify format)\nconst productImage = productData.images && productData.images.length > 0 \n  ? productData.images[0].src \n  : 'https://via.placeholder.com/800x400/2563eb/ffffff?text=No+Image+Available';\n\n// Clean up any problematic newlines from AI output\nfunction cleanText(text) {\n  if (!text) return '';\n  return text\n    .replace(/\\n\\s*\\n/g, ' ')\n    .replace(/[\\r\\n]+/g, ' ')\n    .replace(/\\s+/g, ' ')\n    .trim();\n}\n\n// Shopify-safe JSON escaping function\nfunction makeJsonSafe(text) {\n  if (!text) return '';\n  return text\n    .replace(/\\\\/g, '\\\\\\\\')     // Escape backslashes first\n    .replace(/\"/g, '\\\\\"')       // Escape double quotes\n    .replace(/\\n/g, '\\\\n')      // Escape newlines\n    .replace(/\\r/g, '');        // Remove carriage returns\n}\n\n// Clean and escape ALL text fields\nconst cleanedData = {\n  article_title: makeJsonSafe(cleanText(aiData.article_title)),\n  introduction: makeJsonSafe(cleanText(aiData.introduction)),\n  problem_title: makeJsonSafe(cleanText(aiData.problem_title)),\n  problem_paragraph: makeJsonSafe(cleanText(aiData.problem_paragraph)),\n  solution_title: makeJsonSafe(cleanText(aiData.solution_title)),\n  solution_paragraph: makeJsonSafe(cleanText(aiData.solution_paragraph)),\n  problem_pointers: aiData.problem_pointers.map(p => ({\n    name: makeJsonSafe(cleanText(p.name)),\n    value: makeJsonSafe(cleanText(p.value))\n  })),\n  features_and_benefits: aiData.features_and_benefits.map(fb => ({\n    name: makeJsonSafe(cleanText(fb.name)),\n    value: makeJsonSafe(cleanText(fb.value))\n  })),\n  technical_specifications: aiData.technical_specifications.map(spec => ({\n    name: makeJsonSafe(cleanText(spec.name)),\n    value: makeJsonSafe(cleanText(spec.value))\n  })),\n  real_life_usage: aiData.real_life_usage.map(scenario => ({\n    title: makeJsonSafe(cleanText(scenario.title)),\n    description: makeJsonSafe(cleanText(scenario.description)),\n    points: scenario.points.map(point => ({\n      name: makeJsonSafe(cleanText(point.name)),\n      value: makeJsonSafe(cleanText(point.value))\n    }))\n  })),\n  comparative_advantage: aiData.comparative_advantage.map(comp => ({\n    factor: makeJsonSafe(cleanText(comp.factor)),\n    this_product: makeJsonSafe(cleanText(comp.this_product)),\n    others: makeJsonSafe(cleanText(comp.others))\n  })),\n  recommendations_and_cta: {\n    title: makeJsonSafe(cleanText(aiData.recommendations_and_cta.title)),\n    description: makeJsonSafe(cleanText(aiData.recommendations_and_cta.description))\n  }\n};\n\n// Build BODY HTML (no escaping needed here - HTML content)\nconst bodyHtmlParts = [\n  `<div class=\"hero\" style=\"background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:2.5rem;border-radius:20px;margin:2rem 0;box-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);text-align:center;position:relative;overflow:hidden;\"><h1 style=\"margin:0;font-size:2.5rem;font-weight:800;\">${cleanedData.article_title}</h1><p style=\"font-size:1.2rem;margin:1rem 0 0;opacity:0.95;\">${cleanedData.introduction}</p></div>`,\n\n  `<div class=\"product-image\" style=\"text-align:center;margin:3rem 0;\"><img src=\"${productImage}\" alt=\"${cleanedData.article_title}\" loading=\"lazy\" style=\"max-width:100%;max-height:400px;height:auto;border-radius:24px;box-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);border:4px solid white;\"></div>`,\n\n  `<div class=\"card\" style=\"background:white;border-radius:16px;padding:2rem;margin:1.5rem 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);border:1px solid #e2e8f0;\"><h2 style=\"font-size:1.75rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem;padding-bottom:0.75rem;border-bottom:3px solid #2563eb;\">${cleanedData.problem_title}</h2><p style=\"margin-bottom:1.5rem;line-height:1.7;\">${cleanedData.problem_paragraph}</p><ul style=\"margin-top:1rem;list-style:none;padding:0;\">${cleanedData.problem_pointers.map(pointer => `<li style=\"padding:1rem;margin:0.75rem 0;background:linear-gradient(90deg,#f8fafc,#f1f5f9);border-radius:12px;border-left:4px solid #2563eb;font-size:1rem;\"><strong style=\"color:#1e40af;display:block;margin-bottom:0.25rem;font-size:1.05rem;\">${pointer.name}</strong> ${pointer.value}</li>`).join('')}</ul></div>`,\n\n  `<div class=\"card\" style=\"background:white;border-radius:16px;padding:2rem;margin:1.5rem 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);border:1px solid #e2e8f0;\"><h2 style=\"font-size:1.75rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem;padding-bottom:0.75rem;border-bottom:3px solid #2563eb;\">${cleanedData.solution_title}</h2><p style=\"line-height:1.7;\">${cleanedData.solution_paragraph}</p></div>`,\n\n  `<div class=\"card\" style=\"background:white;border-radius:16px;padding:2rem;margin:1.5rem 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);border:1px solid #e2e8f0;\"><h2 style=\"font-size:1.75rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem;padding-bottom:0.75rem;border-bottom:3px solid #2563eb;\">Key Features & Benefits</h2><ul style=\"margin-top:1rem;list-style:none;padding:0;\">${cleanedData.features_and_benefits.map(fb => `<li style=\"padding:1rem;margin:0.75rem 0;background:linear-gradient(90deg,#f8fafc,#f1f5f9);border-radius:12px;border-left:4px solid #2563eb;font-size:1rem;\"><strong style=\"color:#1e40af;display:block;margin-bottom:0.25rem;font-size:1.05rem;\">${fb.name}</strong><br>${fb.value}</li>`).join('')}</ul></div>`,\n\n  `<div class=\"card\" style=\"background:white;border-radius:16px;padding:2rem;margin:1.5rem 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);border:1px solid #e2e8f0;\"><h2 style=\"font-size:1.75rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem;padding-bottom:0.75rem;border-bottom:3px solid #2563eb;\">Technical Specifications</h2><ul style=\"display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;margin:1.5rem 0 0;list-style:none;padding:0;\">${cleanedData.technical_specifications.map(spec => `<li style=\"padding:1.25rem;border-radius:12px;background:#f0f9ff;border:1px solid #bae6fd;\"><strong style=\"color:#1e40af;\">${spec.name}:</strong> ${spec.value}</li>`).join('')}</ul></div>`,\n\n  `<h2 style=\"font-size:1.75rem;font-weight:700;color:#1f2937;margin:3rem 0 1.5rem;padding-bottom:0.75rem;border-bottom:3px solid #2563eb;\">Real Life Usage</h2>${cleanedData.real_life_usage.map(scenario => `<div class=\"usage-card\" style=\"background:linear-gradient(135deg,#fef3c7 0%,#fde68a 100%);border:1px solid #f59e0b;border-radius:16px;overflow:hidden;margin:2rem 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);\"><h3 style=\"background:#f59e0b;color:white;padding:1rem 1.5rem;margin:0;font-size:1.2rem;font-weight:600;\">${scenario.title}</h3><div class=\"usage-meta\" style=\"padding:1rem 1.5rem 0.5rem;color:#92400e;font-style:italic;\">${scenario.description}</div><ul style=\"margin:0;padding-left:1.5rem;\">${scenario.points.map(point => `<li style=\"padding-left:1.5rem;margin:0.75rem 0;\"><strong style=\"display:block;margin-bottom:0.25rem;font-size:1.05rem;color:#1e40af;\">${point.name}:</strong> ${point.value}</li>`).join('')}</ul></div>`).join('')}`,\n\n  `<div class=\"card\" style=\"background:white;border-radius:16px;padding:2rem;margin:1.5rem 0;box-shadow:0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);border:1px solid #e2e8f0;\"><h2 style=\"font-size:1.75rem;font-weight:700;color:#1f2937;margin:0 0 1.5rem;padding-bottom:0.75rem;border-bottom:3px solid #2563eb;\">Comparative Advantage</h2><table style=\"width:100%;border-collapse:collapse;border-spacing:0;margin:2rem 0 0;\"><tr style=\"background:linear-gradient(135deg,#2563eb,#1e40af);\"><th style=\"color:white;padding:1.25rem 1rem;font-weight:600;text-align:left;\">Factor</th><th style=\"color:white;padding:1.25rem 1rem;font-weight:600;text-align:left;\">${cleanedData.article_title.split(':')[0]} Advantage</th><th style=\"color:white;padding:1.25rem 1rem;font-weight:600;text-align:left;\">Competitors</th></tr>${cleanedData.comparative_advantage.map(comp => `<tr><td style=\"padding:1.25rem 1rem;border-bottom:1px solid #e2e8f0;font-weight:600;color:#1e40af;width:25%;\">${comp.factor}</td><td style=\"padding:1.25rem 1rem;border-bottom:1px solid #e2e8f0;\">${comp.this_product}</td><td style=\"padding:1.25rem 1rem;border-bottom:1px solid #e2e8f0;\">${comp.others}</td></tr>`).join('')}</table></div>`,\n\n  `<div class=\"cta\" style=\"background:linear-gradient(135deg,#2563eb,#1e40af);color:white;padding:3rem 2rem;border-radius:24px;text-align:center;margin:4rem 0 2rem;box-shadow:0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);\"><h2 style=\"font-size:2rem;margin:0 0 1rem;font-weight:700;\">${cleanedData.recommendations_and_cta.title}</h2><p style=\"font-size:1.15rem;margin:0;line-height:1.6;\">${cleanedData.recommendations_and_cta.description}</p></div>`\n];\n\n// Join and clean body_html\nconst rawBodyHtml = bodyHtmlParts.join('').replace(/[\\r\\n]+/g, '');\nconst body_html = makeJsonSafe(rawBodyHtml); // FINAL JSON escaping\n\n// Return PERFECTLY clean Shopify JSON\nreturn [{\n  json: {\n    article: {\n      title: cleanedData.article_title,\n      body_html: body_html,\n      excerpt: cleanedData.introduction.substring(0, 160) + '...',\n      published: true,\n      tags: \"product-review, featured\"\n    }\n  }\n}];"},"id":"a2453318-c638-4cca-9cea-fc0f5f943978","name":"HTML structuring","type":"n8n-nodes-base.code","position":[1328,1136],"typeVersion":2},{"parameters":{"operation":"update","documentId":{"__rl":true,"mode":"list","value":"1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit?usp=drivesdk","cachedResultName":"shopify_to_blog"},"sheetName":{"__rl":true,"mode":"list","value":"gid=0","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1mKEh5BO9v8bY1iJNQDxu8Kvy1GMaTFheifvhCenfZOQ/edit#gid=0","cachedResultName":"data"},"columns":{"value":{"id":"={{ $('input update').item.json.id }}","status":"blog generated","ai_blog":"={{ $json.article.body_html }}"},"schema":[{"id":"id","type":"string","display":true,"removed":false,"required":false,"displayName":"id","defaultMatch":true,"canBeUsedToMatch":true},{"id":"title","type":"string","display":true,"removed":true,"required":false,"displayName":"title","defaultMatch":false,"canBeUsedToMatch":true},{"id":"body_html","type":"string","display":true,"removed":true,"required":false,"displayName":"body_html","defaultMatch":false,"canBeUsedToMatch":true},{"id":"ai_blog","type":"string","display":true,"required":false,"displayName":"ai_blog","defaultMatch":false,"canBeUsedToMatch":true},{"id":"vendor","type":"string","display":true,"removed":true,"required":false,"displayName":"vendor","defaultMatch":false,"canBeUsedToMatch":true},{"id":"product_type","type":"string","display":true,"removed":true,"required":false,"displayName":"product_type","defaultMatch":false,"canBeUsedToMatch":true},{"id":"handle","type":"string","display":true,"removed":true,"required":false,"displayName":"handle","defaultMatch":false,"canBeUsedToMatch":true},{"id":"images","type":"string","display":true,"removed":true,"required":false,"displayName":"images","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"string","display":true,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"row_number","type":"number","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"row_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["id"],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"id":"045c226c-6517-4915-8383-5f7320362449","name":"update content","type":"n8n-nodes-base.googleSheets","position":[1600,1136],"typeVersion":4.7},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":3,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"0bb153d6-c8b3-4082-a902-690eeeff1947","operator":{"type":"number","operation":"exists","singleValue":true},"leftValue":"={{ $json.id }}","rightValue":0}]},"renameOutput":true,"outputKey":"available"},{"conditions":{"options":{"version":3,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"6064ea97-acb7-4a60-8d84-1f90b9e78065","operator":{"type":"number","operation":"notExists","singleValue":true},"leftValue":"={{ $json.id }}","rightValue":""}]},"renameOutput":true,"outputKey":"no output"}]},"options":{}},"id":"291f997c-3bcc-47dc-a649-7cb495c1c411","name":"error handling","type":"n8n-nodes-base.switch","position":[1824,1136],"typeVersion":3.4},{"parameters":{"content":"","height":512,"width":1344,"color":7},"id":"e37f2b02-2b6f-4d23-9f00-8274cdccbdaf","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[880,240],"typeVersion":1},{"parameters":{"content":"","height":672,"width":1344,"color":7},"id":"26bbe4d7-1779-40f3-8609-e7beb2ad1434","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[880,768],"typeVersion":1},{"parameters":{"content":"# Author Details\n## Manish Kumar\n### AI Engineer helping brands scale with Custom Shopify Apps & other AI Automations\n## Contact:\n### üìß [manipritraj@gmail.com](mailto:manipritraj@gmail.com)\n### üìû +91-9334888899\n\n","height":272,"width":496,"color":2},"id":"0781ee33-2b39-4325-874f-23f178a2b8f2","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","position":[368,464],"typeVersion":1},{"parameters":{"content":"![Manish Kumar](https://i.ibb.co/kg9fW8P4/Screenshot-2025-12-30-at-12-55-21-AM.png)\n","height":208,"width":496,"color":7},"id":"830f636f-f246-47ef-b9e2-fe51e08b4d0f","name":"Sticky Note11","type":"n8n-nodes-base.stickyNote","position":[368,240],"typeVersion":1},{"parameters":{"content":"## Shopify Product-to-Blog Automation (AI + Google Sheets) with Perplexity & Gemini\n\nAutomate your e-commerce content strategy by transforming new Shopify products into high-quality, SEO-optimized blog posts. This workflow monitors your store, researches market trends, and publishes structured articles automatically.\n\n### How it works\n1. Trigger: Detects a new product creation in your Shopify store.\n2. Research: Uses Perplexity AI to perform live web research on search intent, target audience, and customer pain points.\n3. Generation: An AI agent powered by Gemini processes the research and product data to write a structured, professional blog post.\n4. Formatting: A JavaScript step converts the AI output into a custom-styled HTML template with your product images.\n5. Publishing: Automatically creates the blog article in Shopify and logs the entry in a Google Sheet for tracking.\n\n### Setup\n- [ ] Connect your Shopify account with Admin API access.\n- [ ] Link your Google Sheets account and select your tracking spreadsheet.\n- [ ] Add your Perplexity API key to the research node.\n- [ ] Add your Google Gemini API key to the AI nodes.\n- [ ] Update the Shopify Blog ID in the HTTP Request node URL.\n- [ ] Ensure your Google Sheet has a column named 'status' to track progress.\n- [ ] Enable the Shopify Trigger to start monitoring for new products.\n","height":686,"width":500,"color":2},"id":"4bcef998-d528-4b2c-92b9-ceac1d9bd3cc","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[368,752],"typeVersion":1}],"connections":{"Gemini":{"ai_languageModel":[[{"node":"content generator","type":"ai_languageModel","index":0}]]},"Memory":{"ai_memory":[[{"node":"content generator","type":"ai_memory","index":0}]]},"Gemini3":{"ai_languageModel":[[{"node":"Output Parser1","type":"ai_languageModel","index":0}]]},"input set":{"main":[[{"node":"input update","type":"main","index":0}]]},"Structured":{"ai_outputParser":[[{"node":"Output Parser1","type":"ai_outputParser","index":0}]]},"web search":{"main":[[{"node":"content generator","type":"main","index":0}]]},"input update":{"main":[[{"node":"web search","type":"main","index":0}]]},"Output Parser1":{"ai_outputParser":[[{"node":"content generator","type":"ai_outputParser","index":0}]]},"error handling":{"main":[[{"node":"get product data","type":"main","index":0}],[{"node":"input update","type":"main","index":0}]]},"update content":{"main":[[{"node":"error handling","type":"main","index":0}]]},"Shopify Trigger":{"main":[[{"node":"input set","type":"main","index":0}]]},"HTML structuring":{"main":[[{"node":"update content","type":"main","index":0}]]},"article creation":{"main":[[{"node":"update blog post status","type":"main","index":0}]]},"get product data":{"main":[[{"node":"article creation","type":"main","index":0}]]},"content generator":{"main":[[{"node":"HTML structuring","type":"main","index":0}]]},"update blog post status":{"main":[[{"node":"No Operation","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","availableInMCP":false},"staticData":null,"meta":{"templateId":"12286"},"pinData":{},"versionId":"77463cc3-cc85-4619-932c-3214294144e3","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-26T15:33:38.880Z","createdAt":"2026-01-26T15:33:38.880Z","role":"workflow:owner","workflowId":"uA8N0WuuKGxQbWyOmGSnz","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]},{"updatedAt":"2026-01-29T11:37:02.229Z","createdAt":"2026-01-28T15:04:47.971Z","id":"zAapWdpWFPqd3oYX","name":"Email Quotidien Automatique","active":false,"isArchived":false,"nodes":[{"parameters":{"assignments":{"assignments":[{"id":"result1","name":"agent_response","value":"‚úÖ Agent IA configur√© et pr√™t","type":"string"},{"id":"result2","name":"openrouter_status","value":"‚ö™ Non configur√©","type":"string"},{"id":"result3","name":"gmail_status","value":"‚ö™ Non configur√©","type":"string"}]},"options":{}},"id":"3c4d5e6f-3333-3333-3333-333333333333","name":"Agent IA Simulation","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[192,144]},{"parameters":{"rule":{"interval":[{"triggerAtHour":17,"triggerAtMinute":45}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.3,"position":[192,368],"id":"6f8ca7bc-8048-4a5f-9fda-165af62d34ff","name":"Schedule Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"8a47f15a-3ec5-4a38-8d15-00d5b6ee942b","name":"","value":"","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[256,624],"id":"7a1122ce-3eeb-41bd-889c-c45a0312cea9","name":"Edit Fields"},{"parameters":{"assignments":{"assignments":[{"id":"1351c5e6-5ff1-4b73-8616-7cc5b5e95d52","name":"Subject","value":"Bonjour ! Voici votre email quotidien","type":"string"},{"id":"373ef48e-0d82-43b9-9fe4-5650d0ca2aff","name":"body","value":"=   Bonjour !        Ceci est votre email quotidien automatique envoy√© √† 17h45.        Date : {{ $now.toFormat('dd/MM/yyyy') }}    Heure : {{ $now.toFormat('HH:mm') }}        Bonne journ√©e !    ","type":"string"},{"id":"a8d985b8-a71f-4992-918d-6abcb8556093","name":"toEmail","value":"cheneliam2006@gmail.com","type":"string"}]},"options":{}},"id":"2b3c4d5e-2222-2222-2222-222222222222","name":"Pr√©parer Email","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[416,368]},{"parameters":{"options":{}},"type":"n8n-nodes-base.gmail","typeVersion":2.2,"position":[624,368],"id":"f7cdf81e-5bb1-45bf-a618-9c77b3ec11f0","name":"Send a message","webhookId":"826478c4-e3cc-43e6-8d42-afb11b865c87","credentials":{"gmailOAuth2":{"id":"Mlo234xMyjXOJTwX","name":"Gmail account"}}}],"connections":{"Agent IA Simulation":{"main":[[]]},"Schedule Trigger":{"main":[[{"node":"Pr√©parer Email","type":"main","index":0}]]},"Pr√©parer Email":{"main":[[{"node":"Send a message","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","availableInMCP":false},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"85f288ba-4cd1-4ea6-9b6c-996690e206d0","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2026-01-28T15:04:47.973Z","createdAt":"2026-01-28T15:04:47.973Z","role":"workflow:owner","workflowId":"zAapWdpWFPqd3oYX","projectId":"9ty5ZNp7nWgSxeMt"}],"activeVersion":null,"tags":[]}],"nextCursor":null}